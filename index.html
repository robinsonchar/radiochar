<!doctype html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Radiochar - La emisora online número uno en Latam transmitiendo Hits de los 80s y 90s 24/7. Escucha en vivo rock, pop y baladas.">
  <meta name="theme-color" content="#0f0f0f">
  <title>RADIOCHAR</title>
  
  <!-- PRELOAD CRÍTICO -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="preconnect" href="https://cdnjs.cloudflare.com">
  <link rel="preconnect" href="https://blogger.googleusercontent.com">
  
  <!-- ESTILOS -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" media="print" onload="this.media='all'" />
  <noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"></noscript>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700;800;900&family=Russo+One&display=swap" rel="stylesheet">

  <style>
    /* 1. VARIABLES CSS */
    :root {
        --color-bg: #0f0f0f;
        --color-text-main: #ffffff;
        --color-text-muted: #aaaaaa;
        --color-accent-blue: #00c6ff;
        --color-accent-gold: #ffd700; 
        --color-accent-pink: #ff00de;
        --color-accent-green: #39ff14; 
        --color-accent-orange: #ff9900;
        --color-accent-red: #ff0000;
        --color-gradient-req: linear-gradient(135deg, #ff00de, #00c6ff);
        
        --z-background: -1; --z-content: 5; --z-player-ui: 10; --z-chat: 9999; --z-modal: 10000; --z-splash: 11000;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }
    html { scroll-behavior: smooth; }

    body {
      font-family: 'Poppins', sans-serif;
      background: var(--color-bg); color: var(--color-text-main);
      overflow-x: hidden; min-height: 100vh;
      display: flex; flex-direction: column; align-items: center; justify-content: flex-start;
      position: relative; padding-bottom: 80px;
      -webkit-font-smoothing: antialiased;
    }

    /* FONDO OPTIMIZADO */
    .background-blur {
      position: fixed; top: -10%; left: -10%; width: 120%; height: 120%;
      z-index: var(--z-background);
      background-image: url('https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgLNh9EesljZjOf9Wd4kxbj_a-I04zgQmfpM1gcDbEF6PXkq7CtZ-71Kgc8TwALbpRGi3EDbTIjTEI1N5QRDDXqD6QhV3UHE79leufBWqZoAxys7KiIcviuxnB-ozdP15EVtEGONWR_ZeHPabjdfUd_X8FkdcoDCtVrNvolF3fQyA8N7eLEoozmI895tiEf/s16000/radiochar-vice.png');
      background-size: cover; background-position: center;
      filter: blur(60px) brightness(0.2);
      transform: translateZ(0); 
      will-change: opacity; transition: background-image 1s ease-in-out;
      pointer-events: none;
    }
    .visual-transition { transition: opacity 0.8s ease-in-out; opacity: 1; }
    .fading-out { opacity: 0 !important; }

    /* HEADER */
    header { margin-top: 60px; margin-bottom: 40px; z-index: var(--z-content); text-align: center; }
    .radio-logo { display: block; max-width: 400px; width: 80%; height: auto; margin: 0 auto; padding: 0 10px; filter: drop-shadow(0 0 10px rgba(255, 255, 255, 0.1)); }

    /* SPINNER */
    .splash-screen {
      position: fixed; inset: 0; background: var(--color-bg);
      display: flex; flex-direction: column; align-items: center; justify-content: center;
      z-index: var(--z-splash); transition: opacity 1s ease, visibility 1s ease;
    }
    .splash-screen.hidden { opacity: 0; visibility: hidden; pointer-events: none; }
    .spinner { border: 3px solid #333; border-top: 3px solid #fff; border-radius: 50%; width: 40px; height: 40px; animation: spin 0.8s linear infinite; }
    @keyframes spin { to { transform: rotate(360deg); } }

    /* MODALES */
    .modal-overlay {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background: rgba(0, 0, 0, 0.85); backdrop-filter: blur(10px);
        z-index: var(--z-modal); display: none; align-items: center; justify-content: center;
        opacity: 0; visibility: hidden; transition: all 0.3s ease;
    }
    .modal-overlay.active { display: flex; opacity: 1; visibility: visible; }
    .modal-content { 
        background: #1a1a1a; width: 600px; max-width: 90%; padding: 30px; 
        border-radius: 16px; border: 1px solid rgba(255, 255, 255, 0.1); 
        box-shadow: 0 25px 50px rgba(0, 0, 0, 0.8); position: relative; 
        transform: translateY(20px); transition: transform 0.3s ease;
        max-height: 85vh; overflow-y: auto; scrollbar-width: thin; scrollbar-color: #444 #1a1a1a;
    }
    .modal-overlay.active .modal-content { transform: translateY(0); }
    .modal-close { position: absolute; top: 20px; right: 20px; background: rgba(255,255,255,0.1); border: none; color: #fff; width: 32px; height: 32px; border-radius: 50%; font-size: 16px; cursor: pointer; transition: all 0.3s; display: flex; align-items: center; justify-content: center; }
    .modal-close:hover { background: rgba(255,255,255,0.3); transform: rotate(90deg); }
    .modal-title { font-size: 24px; font-weight: 800; margin-bottom: 5px; color: #fff; letter-spacing: 0.5px; }
    .modal-subtitle { font-size: 13px; color: var(--color-accent-blue); margin-bottom: 25px; font-weight: 700; text-transform: uppercase; letter-spacing: 1.5px; }
    .modal-body { font-size: 14px; line-height: 1.7; color: #ccc; }
    .modal-meta { margin-top: 25px; padding-top: 20px; border-top: 1px solid rgba(255,255,255,0.1); display: flex; gap: 30px; font-size: 12px; color: #888; text-transform: uppercase; letter-spacing: 1px; }
    .modal-meta span { display: block; color: #fff; font-weight: 700; margin-top: 5px; font-size: 14px; text-transform: none; letter-spacing: 0; }

    /* FORMULARIO PEDIDOS */
    .req-form-group { margin-bottom: 20px; text-align: left; }
    .req-label { display: block; font-size: 11px; color: #aaa; margin-bottom: 8px; text-transform: uppercase; letter-spacing: 1px; font-weight: 600; }
    .req-input { width: 100%; padding: 14px 16px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); color: #fff; border-radius: 8px; font-family: 'Poppins', sans-serif; font-size: 15px; transition: all 0.3s ease; }
    .req-input:focus { border-color: var(--color-accent-blue); background: rgba(255,255,255,0.1); outline: none; box-shadow: 0 0 0 3px rgba(0, 198, 255, 0.2); }
    .req-search-results { margin-top: 10px; max-height: 250px; overflow-y: auto; border: 1px solid rgba(255,255,255,0.1); border-radius: 8px; background: #111; display: none; }
    .req-search-results.active { display: block; }
    .req-item { display: flex; align-items: center; padding: 12px; border-bottom: 1px solid rgba(255,255,255,0.05); cursor: pointer; transition: background 0.2s; }
    .req-item:hover { background: rgba(255,255,255,0.15); }
    .req-item img { width: 45px; height: 45px; border-radius: 4px; margin-right: 15px; object-fit: cover; background: #333; }
    .req-item-info { flex: 1; min-width: 0; }
    .req-item-title { font-weight: 700; font-size: 14px; color: #fff; display: block; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .req-item-artist { font-size: 12px; color: #999; display: block; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; margin-top: 2px; }
    .req-submit { width: 100%; padding: 16px; background: var(--color-gradient-req); color: #fff; border: none; border-radius: 50px; font-weight: 700; font-size: 16px; cursor: pointer; transition: transform 0.2s, box-shadow 0.2s, opacity 0.2s; margin-top: 10px; text-transform: uppercase; letter-spacing: 1px; }
    .req-submit:hover { transform: translateY(-2px); box-shadow: 0 10px 25px rgba(0,198,255,0.3); }
    #realCentovaForm { display: none; }

    /* REPRODUCTOR */
    .radio-container {
      display: flex; width: 1000px; max-width: 95%; height: 320px;
      background: rgba(30, 30, 30, 0.6); backdrop-filter: blur(20px);
      border-radius: 20px; box-shadow: 0 30px 70px rgba(0, 0, 0, 0.5);
      overflow: hidden; position: relative; border: 1px solid rgba(255, 255, 255, 0.05);
      margin: 30px auto 80px auto; flex-shrink: 0; z-index: var(--z-content);
    }
    .cover { flex: 0 0 320px; position: relative; overflow: hidden; }
    .cover img { width: 100%; height: 100%; object-fit: cover; display: block; transition: transform 0.5s ease; }
    .album-year-badge { position: absolute; bottom: 15px; left: 15px; background: rgba(0,0,0,0.7); color: #fff; padding: 4px 12px; border-radius: 20px; font-size: 12px; font-weight: 600; z-index: 10; backdrop-filter: blur(4px); border: 1px solid rgba(255,255,255,0.1); }
    .wiki-btn { position: absolute; top: 15px; right: 15px; width: 32px; height: 32px; background: rgba(0, 0, 0, 0.5); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: rgba(255, 255, 255, 0.9); text-decoration: none; transition: all 0.3s ease; border: 1px solid rgba(255, 255, 255, 0.2); z-index: 20; backdrop-filter: blur(5px); cursor: pointer; }
    .wiki-btn:hover { background: rgba(255, 255, 255, 0.9); color: #000; transform: scale(1.1); border-color: #fff; }

    .player { flex: 1; min-width: 0; display: flex; flex-direction: column; justify-content: center; padding: 30px 40px; position: relative; }
    #winampVis { position: absolute; bottom: 0; left: 0; width: 100%; height: 100%; z-index: 0; pointer-events: none; opacity: 0.1; }
    .info-wrapper { z-index: 5; text-align: left; margin-bottom: 25px; width: 100%; overflow: hidden; }
    .player-meta-row { display: flex; align-items: center; gap: 12px; margin-bottom: 8px; width: 100%; justify-content: flex-start; flex-wrap: wrap; }
    .live-tag-inline { display: flex; align-items: center; gap: 6px; color: #fff; font-size: 11px; font-weight: 800; letter-spacing: 1px; flex-shrink: 0; }
    .live-dot-inline { width: 8px; height: 8px; border-radius: 50%; background-color: #ff0000; box-shadow: 0 0 8px rgba(255, 0, 0, 0.8); animation: blink 1.5s infinite; }
    .listener-tag-inline { display: flex; align-items: center; gap: 5px; font-size: 11px; font-weight: 600; color: #888; flex-shrink: 0; }
    .listener-tag-inline i { font-size: 10px; color: #aaa; }
    .meta-separator { color: #555; font-size: 12px; font-weight: 300; }
    .request-link { font-size: 11px; color: #fff; text-decoration: none; cursor: pointer; font-weight: 800; transition: color 0.3s; letter-spacing: 1px; text-transform: uppercase; }
    .request-link:hover { color: var(--color-accent-blue); }
    .program-tag-inline { display: flex; align-items: center; gap: 6px; font-size: 11px; font-weight: 700; color: var(--color-accent-gold); text-transform: uppercase; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; border-left: 1px solid rgba(255,255,255,0.2); padding-left: 15px; letter-spacing: 0.5px; }
    .program-tag-inline i { color: var(--color-accent-gold); font-size: 10px; }
    @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }

    .song-title-container { width: 100%; white-space: nowrap; overflow: hidden; }
    .song-title-container.is-scrolling { mask-image: linear-gradient(to right, black 90%, transparent 100%); -webkit-mask-image: linear-gradient(to right, black 90%, transparent 100%); }
    .song-title { font-size: 45px; font-weight: 700; color: #fff; display: inline-block; margin-bottom: 5px; padding-right: 20px; will-change: transform; }
    .artist-name { font-size: 18px; color: var(--color-text-muted); font-weight: 400; display: block; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .scrolling-text { animation: scroll-text 15s linear infinite alternate; }
    @keyframes scroll-text { 0%, 15% { transform: translateX(0); } 85%, 100% { transform: translateX(var(--scroll-distance)); } }

    .timeline-container { width: 100%; display: flex; align-items: center; gap: 15px; margin-bottom: 25px; z-index: 5; }
    .time-display { font-size: 12px; font-weight: 600; color: #ddd; font-variant-numeric: tabular-nums; min-width: 40px; }
    .progress-bar-bg { flex: 1; min-width: 0; height: 6px; background: rgba(255,255,255,0.1); border-radius: 3px; overflow: hidden; position: relative; }
    .progress-bar-fill { height: 100%; width: 0%; background: linear-gradient(90deg, #00c6ff, #0072ff); border-radius: 3px; transition: width 1s linear; }

    .controls-row { display: flex; align-items: center; justify-content: center; z-index: 5; width: 100%; }
    .play-btn-wrapper { position: relative; width: 60px; height: 60px; display: flex; align-items: center; justify-content: center; }
    .play-btn { width: 60px; height: 60px; border-radius: 50%; background: #fff; border: none; color: #121212; font-size: 24px; cursor: pointer; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 15px rgba(255,255,255,0.3); transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); padding-left: 4px; }
    .play-btn:hover { transform: scale(1.1); box-shadow: 0 6px 20px rgba(255,255,255,0.5); }
    .play-btn.playing { padding-left: 0; background: var(--color-accent-blue); color: #fff; }

    /* SECCIONES & TITULOS */
    .content-section { width: 1000px; max-width: 95%; margin: 100px auto; z-index: var(--z-content); }
    .section-header-common { margin-bottom: 30px; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 15px; display: flex; justify-content: space-between; align-items: flex-end; }
    .section-title-common { font-size: 18px; text-transform: uppercase; letter-spacing: 2px; font-weight: 700; padding-left: 10px; margin: 0; }
    .recent-tracks-title-custom { color: var(--color-accent-blue); border-left: 3px solid var(--color-accent-blue); }
    .dyk-title-custom { color: var(--color-accent-pink); border-left: 3px solid var(--color-accent-pink); }
    .schedule-title-custom { color: #fff; border-left: 3px solid #fff; }
    .repo-title-custom { color: var(--color-accent-gold); border-left: 3px solid var(--color-accent-gold); }
    .topchart-title-custom { color: var(--color-accent-green); border-left: 3px solid var(--color-accent-green); }
    .directories-title-custom { color: var(--color-accent-orange); border-left: 3px solid var(--color-accent-orange); }

    .slogan-section { text-align: center; margin-top: 120px; margin-bottom: 120px; }
    .slogan-text { font-family: 'Russo One', sans-serif; font-size: 60px; color: #fff; text-transform: uppercase; text-shadow: 0 0 10px rgba(255, 255, 255, 0.3); letter-spacing: 2px; line-height: 1.1; margin-bottom: 10px; }
    .sub-slogan { font-family: 'Russo One', sans-serif; font-size: 30px; color: #fff; text-transform: uppercase; text-shadow: 0 0 10px rgba(255, 255, 255, 0.3); letter-spacing: 2px; margin-top: 5px; display: flex; align-items: center; justify-content: center; gap: 15px; }

    /* CARD GRID */
    .card-grid-container { display: grid; gap: 20px; }
    .recent-tracks-grid { grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); }

    /* CAROUSEL COMMON */
    .carousel-wrapper-common { position: relative; width: 100%; }
    .carousel-track-common { display: flex; gap: 20px; overflow-x: auto; scroll-behavior: smooth; padding-bottom: 15px; padding-top: 10px; scrollbar-width: none; -ms-overflow-style: none; }
    .carousel-track-common::-webkit-scrollbar { display: none; }
    
    .carousel-card-common { flex: 0 0 200px; background: rgba(30, 30, 30, 0.4); border-radius: 12px; overflow: hidden; border: 1px solid rgba(255,255,255,0.05); transition: transform 0.3s ease, background 0.3s ease; position: relative; cursor: pointer; }
    .carousel-card-common:hover { transform: translateY(-5px); background: rgba(255, 255, 255, 0.08); }
    .carousel-cover-wrap { position: relative; width: 100%; aspect-ratio: 1/1; }
    .carousel-cover { width: 100%; height: 100%; object-fit: cover; }
    .carousel-info { padding: 15px; }
    .carousel-title { font-size: 14px; font-weight: 700; color: #fff; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; margin-bottom: 4px; transition: color 0.3s ease; }
    .carousel-artist { font-size: 12px; color: #aaa; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    
    .rank-badge { position: absolute; top: 10px; left: 10px; width: 35px; height: 35px; background: var(--color-accent-green); color: #000; border-radius: 50%; font-family: 'Russo One', sans-serif; font-size: 18px; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 10px rgba(0,0,0,0.5); z-index: 2; border: 2px solid rgba(0,0,0,0.2); }
    .rank-badge.blue { background: var(--color-accent-blue); color: #fff; border: 2px solid rgba(255,255,255,0.3); }
    .time-badge-inline { font-size: 11px; color: var(--color-accent-blue); margin-top: 6px; font-weight: 600; display: flex; align-items: center; gap: 5px; }
    
    .topchart-section .carousel-card-common:hover .carousel-title { color: var(--color-accent-green) !important; }
    .recent-tracks-container .carousel-card-common:hover .carousel-title { color: var(--color-accent-blue) !important; }

    /* TOP 10 SPLIT */
    .top10-layout { display: flex; gap: 30px; align-items: stretch; width: 100%; }
    .top10-featured { flex: 0 0 35%; max-width: 350px; position: relative; background: rgba(30, 30, 30, 0.4); border-radius: 16px; overflow: hidden; border: 1px solid rgba(255,255,255,0.1); transition: transform 0.3s ease; cursor: pointer; display: flex; flex-direction: column; }
    .top10-featured:hover { transform: scale(1.02); background: rgba(255,255,255,0.05); }
    .top10-featured-cover-wrap { width: 100%; aspect-ratio: 1/1; position: relative; flex-shrink: 0; }
    .top10-featured-cover { width: 100%; height: 100%; object-fit: cover; }
    .top10-rank-big { position: absolute; top: 15px; left: 15px; width: 50px; height: 50px; background: var(--color-accent-green); color: #000; font-family: 'Russo One', sans-serif; font-size: 28px; border-radius: 50%; display: flex; align-items: center; justify-content: center; box-shadow: 0 5px 15px rgba(0,0,0,0.6); border: 3px solid rgba(255,255,255,0.3); z-index: 2; }
    .top10-featured-info { padding: 20px; text-align: left; display: flex; flex-direction: column; flex-grow: 1; }
    .top10-featured-title { font-size: 20px; font-weight: 800; color: #fff; margin-bottom: 5px; line-height: 1.2; transition: color 0.3s ease; text-align: center; }
    .top10-featured-artist { font-size: 14px; color: var(--color-accent-green); font-weight: 600; text-transform: uppercase; letter-spacing: 1px; text-align: center; }
    .top10-featured:hover .top10-featured-title { color: var(--color-accent-green) !important; }
    
    .top10-featured-review { margin-top: 15px; font-size: 13px; color: #ddd; font-style: normal; line-height: 1.5; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 15px; text-align: justify; flex-grow: 1; overflow: hidden; display: flex; flex-direction: column; }
    .top10-featured-review strong { color: var(--color-accent-blue); font-weight: 600; }
    .top10-meta-block { display: block; margin-top: 10px; font-size: 12px; color: #aaa; }

    .top10-list-container { flex: 1; display: flex; flex-direction: column; gap: 10px; }
    .top10-item { display: flex; align-items: center; background: rgba(255, 255, 255, 0.03); padding: 12px 15px; border-radius: 8px; border: 1px solid rgba(255, 255, 255, 0.05); transition: all 0.2s ease; cursor: default; }
    .top10-item:hover { background: rgba(255, 255, 255, 0.1); transform: translateX(5px); border-color: var(--color-accent-green); }
    .top10-item-rank { font-family: 'Russo One', sans-serif; font-size: 18px; color: var(--color-accent-green); width: 30px; text-align: center; margin-right: 15px; flex-shrink: 0; }
    .top10-item-info { flex: 1; overflow: hidden; }
    .top10-item-title { font-size: 14px; font-weight: 700; color: #fff; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; margin-bottom: 2px; transition: color 0.3s ease; }
    .top10-item-artist { font-size: 12px; color: #aaa; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .top10-item:hover .top10-item-title { color: var(--color-accent-green) !important; }
    
    @media (max-width: 800px) {
        .top10-layout { flex-direction: column; align-items: center; }
        .top10-featured { width: 100%; max-width: 100%; margin-bottom: 20px; }
        .top10-featured-cover-wrap { height: 250px; aspect-ratio: auto; }
        .top10-featured-info { text-align: center; } 
        .top10-featured-title, .top10-featured-artist { text-align: center; }
    }

    /* SCHEDULE */
    .schedule-container-custom { position: relative; width: 100%; overflow: hidden; padding: 40px 0; }
    .schedule-track { display: flex; gap: 0; padding-left: calc(50% - 150px); width: max-content; }
    .schedule-card-item { flex: 0 0 300px; max-width: 300px; padding: 0 15px; transition: opacity 0.5s ease, transform 0.5s ease, filter 0.5s ease; opacity: 0.4; transform: scale(0.9); filter: blur(2px); }
    .schedule-card-item.active-slide { opacity: 1; transform: scale(1.1); filter: blur(0); z-index: 10; }
    .program-card { position: relative; height: 180px; border-radius: 12px; overflow: hidden; border: 1px solid rgba(255,255,255,0.1); box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
    .schedule-card-item.active-slide.is-live .program-card { border: 2px solid var(--color-accent-red); box-shadow: 0 0 30px rgba(255,0,0,0.4); }
    .program-bg { position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; z-index: 1; }
    .program-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(to top, rgba(0,0,0,0.95), rgba(0,0,0,0.3)); z-index: 2; padding: 15px; display: flex; flex-direction: column; justify-content: flex-end; }
    .program-time { font-size: 13px; color: var(--color-accent-gold); font-weight: 700; margin-bottom: 5px; text-shadow: 0 2px 4px rgba(0,0,0,0.8); }
    .program-title { font-family: 'Russo One', sans-serif; font-size: 20px; color: #fff; line-height: 1.1; text-transform: uppercase; }
    .program-subtitle { font-size: 11px; color: var(--color-accent-blue); font-weight: 600; text-transform: uppercase; margin-top: 5px; letter-spacing: 1px; }
    .on-air-badge { position: absolute; top: 10px; right: 10px; background: var(--color-accent-red); color: #fff; font-size: 10px; font-weight: 800; padding: 4px 8px; border-radius: 4px; z-index: 10; animation: blink 1.5s infinite; display: none; }
    .schedule-card-item.is-live .on-air-badge { display: block; }

    /* REPO & FEATURES */
    .repo-grid { 
        display: grid; 
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); 
        gap: 25px; 
    }
    @media (max-width: 350px) {
        .repo-grid { grid-template-columns: 1fr; }
    }

    .repo-card { background: rgba(30, 30, 30, 0.4); border-radius: 12px; overflow: hidden; text-decoration: none; color: inherit; display: flex; flex-direction: column; transition: transform 0.3s ease, background 0.3s ease; border: 1px solid rgba(255,255,255,0.05); }
    .repo-card:hover { transform: translateY(-5px); background: rgba(255, 255, 255, 0.08); }
    .repo-image-wrapper { width: 100%; height: 160px; position: relative; overflow: hidden; }
    .repo-image { width: 100%; height: 100%; object-fit: cover; transition: transform 0.5s ease; }
    .repo-card:hover .repo-image { transform: scale(1.1); }
    .repo-content { padding: 20px; flex: 1; display: flex; flex-direction: column; }
    .repo-card-title { font-size: 18px; font-weight: 700; color: #fff; margin-bottom: 8px; font-family: 'Russo One', sans-serif; letter-spacing: 0.5px; text-transform: uppercase; }
    .repo-card-desc { font-size: 13px; color: #ccc; line-height: 1.5; font-weight: 300; margin-bottom: 0; }

    .feature-card { display: grid; grid-template-columns: 320px 1fr; gap: 30px; background: rgba(74, 74, 74, 0.1); border: none; border-radius: 16px; overflow: hidden; backdrop-filter: blur(10px); height: 320px; }
    .feature-image-wrapper { width: 100%; height: 320px; position: relative; overflow: hidden;}
    .feature-image { width: 100%; height: 100%; object-fit: cover; display: block; border-radius: 12px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); transition: transform 0.5s ease; }
    .feature-card:hover .feature-image { transform: scale(1.05); }
    .feature-badge { position: absolute; top: 15px; left: 15px; color: #fff; font-weight: 700; font-size: 12px; padding: 4px 12px; border-radius: 20px; box-shadow: 0 4px 10px rgba(0,0,0,0.4); text-transform: uppercase; letter-spacing: 1px; z-index: 2; }
    .badge-pink { background: var(--color-accent-pink); border: 1px solid var(--color-accent-pink); }
    .badge-green { background: var(--color-accent-green); border: 1px solid var(--color-accent-green); color: #000; }
    .feature-content { padding: 10px 30px 10px 0; display: flex; flex-direction: column; justify-content: center; height: 100%; overflow: hidden; }
    .feature-headline { font-size: 28px; font-weight: 800; color: #fff; margin-bottom: 5px; line-height: 1.2; }
    .feature-subhead { font-size: 18px; color: var(--color-accent-blue); font-weight: 600; margin-bottom: 20px; }
    .feature-meta { display: flex; gap: 20px; margin-bottom: 25px; font-size: 13px; color: #aaa; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 15px; }
    .feature-text { font-size: 15px; line-height: 1.7; color: #ddd; max-height: 140px; overflow: hidden; display: -webkit-box; -webkit-line-clamp: 8; -webkit-box-orient: vertical; text-overflow: ellipsis; }

    .slider-arrow { position: absolute; top: 50%; transform: translateY(-50%); width: 40px; height: 40px; background: rgba(0,0,0,0.5); color: #fff; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; z-index: 20; transition: all 0.3s ease; border: 1px solid rgba(255,255,255,0.1); }
    .slider-arrow:hover { background: var(--color-accent-gold); color: #000; }
    #recentTracksPrev:hover, #recentTracksNext:hover { background: var(--color-accent-blue); color: #fff; transform: translateY(-50%) scale(1.1); border-color: var(--color-accent-blue); }
    .slider-arrow.left { left: 10px; } .slider-arrow.right { right: 10px; }

    /* FOOTER & CBOX CSS MEJORADO */
    .community-section { text-align: center; margin-top: 100px; margin-bottom: 80px; }
    .community-title { font-family: 'Russo One', sans-serif; font-size: 60px; color: #fff; text-transform: uppercase; text-shadow: 0 0 10px rgba(255, 255, 255, 0.1); margin-bottom: 25px; letter-spacing: 1px; line-height: 1.1; }
    .buttons-container { display: flex; justify-content: center; gap: 20px; flex-wrap: wrap; }
    .btn-social { display: inline-flex; align-items: center; justify-content: center; font-family: 'Poppins', sans-serif; font-size: 20px; font-weight: 700; padding: 15px 40px; border-radius: 50px; text-decoration: none; transition: all 0.3s ease; border: none; cursor: pointer; min-width: 250px; }
    .btn-facebook { background-color: #1877F2; color: #fff; box-shadow: 0 4px 15px rgba(24, 119, 242, 0.4); }
    .btn-facebook:hover { background-color: #1565C0; transform: translateY(-3px); box-shadow: 0 8px 25px rgba(24, 119, 242, 0.6); }
    .btn-x { background-color: #000; color: #fff; box-shadow: 0 4px 15px rgba(255, 255, 255, 0.15); }
    .btn-x:hover { background-color: #111; transform: translateY(-3px); box-shadow: 0 8px 25px rgba(255, 255, 255, 0.25); }
    .btn-social i { margin-right: 12px; font-size: 24px; }
    
    .creator-footer { margin-top: 40px; font-size: 12px; color: rgba(255, 255, 255, 0.4); text-align: center; z-index: var(--z-content); display: flex; flex-direction: row; justify-content: center; align-items: center; min-height: 40px; gap: 5px; }
    .creator-footer a { color: #fff; text-decoration: none; opacity: 0.7; }
    .creator-footer a:hover { opacity: 1; text-decoration: underline; }

    /* CBOX ZERO GAP */
    #cboxbutton { position: fixed; bottom: 20px; right: 20px; z-index: var(--z-chat) !important; border-radius: 50% !important; background-color: #1877F2 !important; border: 1px solid #1565C0 !important; color: #fff !important; width: 60px !important; height: 60px !important; padding: 0 !important; display: flex !important; align-items: center !important; justify-content: center !important; box-shadow: 0 4px 10px rgba(0,0,0,0.3) !important; font-size: 24px !important; cursor: pointer; transition: transform 0.2s ease; }
    #cboxbutton:hover { transform: scale(1.05); }

    #cboxwrap { position: fixed; bottom: 90px; right: 20px; z-index: var(--z-chat) !important; border-radius: 12px !important; border: 1px solid rgba(255, 255, 255, 0.1) !important; background: rgba(30, 30, 30, 0.95) !important; backdrop-filter: blur(10px) !important; box-shadow: 0 10px 40px rgba(0,0,0,0.6) !important; display: none; overflow: hidden; font-size: 0; line-height: 0; }
    
    #cboxdiv { width: 300px; height: 380px; display: block; }
    .cbox-main-wrapper { height: 252px !important; width: 100%; border: 0 !important; display: block; margin: 0; padding: 0; overflow: hidden; }
    .cbox-form-wrapper { height: 128px !important; width: 100%; border: 0 !important; border-top: 1px solid rgba(255,255,255,0.1); display: block; margin: 0; padding: 0; overflow: hidden; }
    #cboxdiv iframe { width: 100%; height: 100%; border: 0; display: block; vertical-align: bottom; margin: 0; padding: 0; }
    
    /* --- SECCIÓN DIRECTORIOS (SIN FILTROS) --- */
    .directories-grid { display: flex; justify-content: center; align-items: center; gap: 30px; flex-wrap: wrap; }
    .directory-link { display: block; transition: all 0.3s ease; }
    .directory-logo { height: 50px; width: auto; filter: none; opacity: 1; transition: transform 0.3s ease; }
    .directory-link:hover .directory-logo { transform: scale(1.05); }
    .directory-card { flex: 0 0 250px; background: rgba(30, 30, 30, 0.4); border-radius: 12px; overflow: hidden; position: relative; cursor: pointer; border: 1px solid rgba(255,255,255,0.05); transition: transform 0.3s ease, background 0.3s ease; display: block; text-decoration: none; backface-visibility: hidden; transform: translateZ(0); }
    .directory-card:hover { transform: translateY(-5px); background: rgba(255, 255, 255, 0.08); border-color: var(--color-accent-orange); }
    .directory-logo-wrap { width: 100%; aspect-ratio: 1/1; display: flex; align-items: center; justify-content: center; padding: 20px; }
    .directory-card img { max-width: 100%; max-height: 100%; width: auto; height: auto; transition: transform 0.3s ease; }
    .directory-card:hover img { transform: scale(1.1); }
    .directory-name { padding: 10px; text-align: center; font-weight: 700; color: #fff; text-transform: uppercase; background: rgba(0,0,0,0.3); font-size: 14px; letter-spacing: 1px; }

    /* ==========================================================================
       MEDIA QUERIES (RESPONSIVE ENGINE V38.0)
       ========================================================================== */

    @media (max-width: 800px) {
        .content-section { margin: 60px auto; }
        .slogan-section { margin: 80px 0; }
        .slogan-text { font-size: 42px; }
        .sub-slogan { font-size: 22px; }
        .community-title { font-size: 32px; }
        .feature-headline { font-size: 24px; }
        .modal-content { width: 90%; margin: 0 auto; }
        .top10-layout { flex-direction: column; align-items: center; gap: 30px; }
        .top10-featured { width: 100%; max-width: 100%; margin-bottom: 10px; }
        .top10-featured-cover-wrap { height: auto; aspect-ratio: 16/9; max-height: 300px; }
        .top10-featured-info { text-align: center; }
        .top10-featured-title, .top10-featured-artist, .top10-featured-review { text-align: center; }
        .feature-card { grid-template-columns: 1fr; height: auto; }
        .feature-image-wrapper { height: 250px; }
        .feature-content { padding: 25px; max-height: none; }
        .feature-text { -webkit-line-clamp: 10; max-height: none; }
        .buttons-container { flex-direction: column; align-items: center; width: 100%; }
        .btn-social { width: 100%; max-width: 320px; }
        .slider-arrow { background: rgba(0,0,0,0.6); width: 35px; height: 35px; }
        .slider-arrow.left { left: 5px; }
        .slider-arrow.right { right: 5px; }
        .schedule-track { padding-left: calc(50% - 135px); } 
        .schedule-card-item { flex: 0 0 270px; max-width: 270px; }
        #cboxwrap { right: 15px; bottom: 85px; }
    }

    @media (max-width: 600px) {
        .radio-container { flex-direction: column; height: auto; width: 92%; margin-top: 20px; padding-bottom: 20px; }
        .cover { flex: 0 0 auto; width: 100%; max-width: 350px; aspect-ratio: 1/1; height: auto; margin: 0 auto; }
        .player { padding: 20px; text-align: center; }
        .info-wrapper { text-align: center; margin-bottom: 15px; }
        .player-meta-row { justify-content: center; }
        .controls-row { justify-content: center; }
        .slogan-text { font-size: 32px; letter-spacing: 1px; }
        .sub-slogan { font-size: 18px; }
        .section-title-common { font-size: 16px; text-align: center; padding-left: 0; border-left: none; border-bottom: 2px solid; padding-bottom: 5px; display: inline-block; }
        .section-header-common { justify-content: center; border-bottom: none; }
        .recent-tracks-grid { grid-template-columns: repeat(2, 1fr); gap: 10px; }
        .hist-title { font-size: 12px; }
        #cboxdiv { width: 85vw !important; }
        #cboxwrap { bottom: 80px !important; right: 50% !important; transform: translateX(50%); border-radius: 12px; } 
        #cboxbutton { bottom: 15px; right: 15px; width: 55px; height: 55px; font-size: 22px; }
        .radio-logo { width: 70%; }
        .program-tag-inline { display: none; } 
    }

    @media (max-width: 360px) {
        .recent-tracks-grid { grid-template-columns: 1fr; }
        .schedule-card-item { flex: 0 0 100%; max-width: 100%; }
        .schedule-track { padding-left: 0; }
        .slider-arrow { display: none; } 
        .schedule-container-custom { overflow-x: auto; scroll-snap-type: x mandatory; }
    }

    .radio-logo { max-width: 450px !important; width: 90% !important; }
    .repo-carousel-wrapper { position: relative; overflow: hidden; padding: 0 50px; }
    .repo-carousel-nav { position: absolute; top: 50%; transform: translateY(-50%); width: 40px; height: 40px; background: rgba(0, 198, 255, 0.8); border: none; border-radius: 50%; color: white; font-size: 20px; cursor: pointer; z-index: 100; display: none; align-items: center; justify-content: center; transition: all 0.3s ease; }
    .repo-carousel-nav:hover { background: rgba(255, 0, 222, 0.9); transform: translateY(-50%) scale(1.1); }
    .repo-carousel-nav.prev { left: 5px; }
    .repo-carousel-nav.next { right: 5px; }
    .repo-carousel-container { display: flex; transition: transform 0.4s ease; gap: 15px; }

    @media screen and (max-width: 1000px) {
      .radio-container { width: 95% !important; max-width: 95% !important; height: auto !important; min-height: auto !important; flex-shrink: 1 !important; }
      .radio-logo { max-width: 400px !important; }
    }

    @media screen and (max-width: 900px) {
      .radio-container { display: flex !important; flex-direction: column !important; width: 90% !important; max-width: 90% !important; height: auto !important; margin: 25px auto 60px !important; }
      .cover { flex: 0 0 auto !important; width: 100% !important; max-width: 100% !important; height: 300px !important; min-height: 300px !important; }
      .cover img { width: 100% !important; height: 100% !important; object-fit: cover !important; }
      .player { flex: 1 1 auto !important; width: 100% !important; padding: 25px 20px !important; }
      .controls { display: flex !important; flex-wrap: wrap !important; justify-content: center !important; gap: 15px !important; }
      .content-section { width: 90% !important; max-width: 90% !important; margin: 50px auto !important; padding: 25px 20px !important; }
      .top10-layout { display: flex !important; flex-direction: column !important; align-items: center !important; }
      .top10-image { width: 100% !important; max-width: 280px !important; margin: 0 auto 25px !important; }
      .top10-image img { width: 100% !important; height: auto !important; max-height: 280px !important; object-fit: contain !important; }
      .top10-list { width: 100% !important; }
    }

    @media screen and (max-width: 700px) {
      body { overflow-x: hidden !important; }
      main { padding: 0 5% !important; width: 100% !important; }
      header { padding: 20px 5% 10px !important; width: 100% !important; }
      .radio-logo { max-width: 85% !important; height: auto !important; }
      .radio-container { width: 90% !important; margin: 20px auto 50px !important; border-radius: 15px !important; }
      .cover { height: 250px !important; min-height: 250px !important; }
      .player { padding: 20px 15px !important; }
      .player-meta-row { display: flex !important; flex-wrap: wrap !important; justify-content: center !important; gap: 8px !important; font-size: 0.75rem !important; text-align: center !important; }
      .meta-separator { display: none !important; }
      .live-tag-inline, .listener-tag-inline, .program-tag-inline, .request-link { font-size: 0.75rem !important; padding: 4px 10px !important; }
      .song-title-container { text-align: center !important; width: 100% !important; }
      #displayTitle { font-size: 1.3rem !important; line-height: 1.3 !important; white-space: normal !important; word-wrap: break-word !important; }
      #displayArtist { font-size: 1rem !important; white-space: normal !important; word-wrap: break-word !important; }
      .controls { flex-direction: column !important; align-items: center !important; width: 100% !important; gap: 15px !important; }
      .btn-play { width: 65px !important; height: 65px !important; font-size: 26px !important; flex-shrink: 0 !important; }
      .volume-wrapper { width: 100% !important; max-width: 100% !important; display: flex !important; justify-content: center !important; align-items: center !important; }
      #volumeControl { flex: 1 !important; max-width: 220px !important; }
      .btn-request { width: 100% !important; max-width: 280px !important; padding: 14px 20px !important; font-size: 0.95rem !important; }
      .wiki-btn { width: 45px !important; height: 45px !important; font-size: 18px !important; }
      .content-section { width: 90% !important; padding: 20px 15px !important; margin: 40px auto !important; }
      .section-title { font-size: 1.5rem !important; margin-bottom: 18px !important; }
      .section-subtitle { font-size: 1rem !important; padding: 0 10px !important; }
      .schedule-grid { grid-template-columns: 1fr !important; gap: 15px !important; }
      .schedule-card { padding: 15px !important; }
      .schedule-time { font-size: 1.05rem !important; }
      .schedule-show { font-size: 0.95rem !important; }
      .schedule-desc { font-size: 0.85rem !important; }
      .top10-layout { gap: 20px !important; }
      .top10-image { max-width: 220px !important; margin-bottom: 20px !important; }
      .top10-image img { max-height: 220px !important; border-radius: 12px !important; }
      .top10-item { padding: 12px !important; flex-wrap: wrap !important; }
      .top10-rank { font-size: 1.4rem !important; min-width: 45px !important; }
      .top10-info-title { font-size: 0.95rem !important; }
      .top10-info-artist { font-size: 0.85rem !important; }
      .repo-grid { display: grid !important; grid-template-columns: repeat(2, 1fr) !important; gap: 15px !important; overflow: hidden !important; }
      .repo-carousel-wrapper { display: block !important; position: relative !important; padding: 0 !important; }
      .repo-carousel-nav { display: flex !important; }
      .repo-card { padding: 15px !important; min-width: calc(50% - 7.5px) !important; }
      .repo-icon { font-size: 2.5rem !important; }
      .repo-title { font-size: 0.95rem !important; }
      .repo-count { font-size: 1.3rem !important; }
      .social-grid { gap: 15px !important; }
      .social-link { width: 55px !important; height: 55px !important; font-size: 24px !important; }
      .modal-overlay { padding: 15px !important; }
      .modal-content { max-width: 90% !important; width: 90% !important; padding: 25px 18px !important; }
      .modal-title { font-size: 1.4rem !important; }
      .modal-subtitle { font-size: 1rem !important; }
      .modal-body { font-size: 0.9rem !important; max-height: 40vh !important; }
      .modal-close { width: 38px !important; height: 38px !important; font-size: 18px !important; }
      .req-form-group { margin-bottom: 15px !important; }
      .req-label { font-size: 0.95rem !important; }
      .req-input { padding: 12px !important; font-size: 0.9rem !important; }
      .req-submit { padding: 14px !important; font-size: 1rem !important; }
      .req-song-item { padding: 10px !important; font-size: 0.85rem !important; }
      footer { padding: 25px 5% !important; margin-top: 40px !important; }
      footer p { font-size: 0.85rem !important; }
    }

    @media screen and (max-width: 550px) {
      .radio-container { width: 92% !important; margin: 15px auto 40px !important; }
      .cover { height: 220px !important; min-height: 220px !important; }
      .player { padding: 18px 12px !important; }
      .player-meta-row { font-size: 0.7rem !important; gap: 6px !important; }
      .live-tag-inline, .listener-tag-inline, .program-tag-inline, .request-link { font-size: 0.7rem !important; padding: 3px 8px !important; }
      #displayTitle { font-size: 1.15rem !important; }
      #displayArtist { font-size: 0.9rem !important; }
      .btn-play { width: 60px !important; height: 60px !important; font-size: 24px !important; }
      .content-section { width: 92% !important; padding: 18px 12px !important; }
      .section-title { font-size: 1.35rem !important; }
      .top10-image { max-width: 180px !important; }
      .top10-image img { max-height: 180px !important; }
      .top10-item { flex-direction: column !important; text-align: center !important; gap: 8px !important; }
      .repo-grid { grid-template-columns: 1fr !important; }
      .repo-card { min-width: 100% !important; }
      .repo-carousel-nav { width: 36px !important; height: 36px !important; font-size: 18px !important; }
    }

    @media screen and (max-width: 450px) {
      .radio-logo { max-width: 90% !important; }
      .radio-container { width: 94% !important; }
      .cover { height: 200px !important; min-height: 200px !important; }
      .player { padding: 15px 10px !important; }
      #displayTitle { font-size: 1.05rem !important; }
      #displayArtist { font-size: 0.85rem !important; }
      .btn-play { width: 55px !important; height: 55px !important; font-size: 22px !important; }
      #volumeControl { max-width: 180px !important; }
      .btn-request { max-width: 100% !important; font-size: 0.9rem !important; }
      .wiki-btn { width: 40px !important; height: 40px !important; font-size: 16px !important; }
      .album-year-badge { font-size: 0.75rem !important; padding: 4px 10px !important; bottom: 10px !important; left: 10px !important; }
      .content-section { width: 94% !important; padding: 15px 10px !important; }
      .section-title { font-size: 1.25rem !important; }
      .top10-image { max-width: 160px !important; }
      .top10-image img { max-height: 160px !important; }
      .social-link { width: 50px !important; height: 50px !important; font-size: 22px !important; }
    }

    @media screen and (max-width: 375px) {
      .radio-container { width: 96% !important; }
      .cover { height: 180px !important; min-height: 180px !important; }
      .player-meta-row { font-size: 0.65rem !important; }
      #displayTitle { font-size: 1rem !important; }
      #displayArtist { font-size: 0.8rem !important; }
      .btn-play { width: 50px !important; height: 50px !important; font-size: 20px !important; }
      .wiki-btn { width: 35px !important; height: 35px !important; font-size: 14px !important; top: 8px !important; right: 8px !important; }
      .content-section { width: 96% !important; }
      .top10-image { max-width: 140px !important; }
      .top10-image img { max-height: 140px !important; }
    }

    @media screen and (max-height: 500px) and (orientation: landscape) {
      .radio-container { height: auto !important; max-height: none !important; }
      .cover { height: 100% !important; min-height: 240px !important; max-height: 280px !important; }
      .modal-content { max-height: 85vh !important; overflow-y: auto !important; }
      .modal-body { max-height: 30vh !important; }
    }

    @media (hover: none) and (pointer: coarse) {
      .btn-play, .btn-request, .wiki-btn, .modal-close, .social-link, .req-submit, .repo-carousel-nav, button, a { min-height: 44px !important; min-width: 44px !important; }
    }

    @media (prefers-reduced-motion: reduce) {
      *, *::before, *::after { animation-duration: 0.01ms !important; animation-iteration-count: 1 !important; transition-duration: 0.01ms !important; scroll-behavior: auto !important; }
    }

    html { overflow-x: hidden !important; width: 100% !important; }
    body { overflow-x: hidden !important; width: 100% !important; max-width: 100vw !important; }
    img, video, iframe { max-width: 100% !important; height: auto !important; }

/* INICIO ESTILOS DJ */
:root {
            --dj-accent: #ff0055;
            --dj-text: #ffffff;
            --dj-transition: 450ms cubic-bezier(0.23, 1, 0.32, 1);
        }

        /* Contenedor principal: Sin background, sin borde, limpio y minimalista */
        .dj-section-wrapper {
            width: 100%;
            max-width: 1000px; /* Ancho ajustado para balancear con el reproductor de radio */
            margin: 20px auto;
            padding: 20px;
            background: transparent; 
            border: none; /* Borde eliminado */
            box-shadow: none;
            color: var(--dj-text);
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Segoe UI', Roboto, Helvetica, sans-serif;
        }

        /* Regla Maestra: Oculta la estructura principal si el skeleton NO está oculto */
        #dj-skeleton:not(.hidden) ~ .dj-main-layout {
            display: none !important;
        }

        /* Estructura en dos bloques paralelos */
        .dj-main-layout {
            display: flex;
            flex-direction: row; /* Diseño horizontal */
            align-items: center;
            gap: 40px; /* Espacio limpio entre la imagen y los textos */
            width: 100%;
        }

        .hidden { display: none !important; }

        /* BLOQUE IZQUIERDO: IMAGEN DEL DJ LIMPIA */
        .dj-visual {
            flex-shrink: 0;
            width: 200px; 
            display: flex;
            justify-content: center;
        }

        #dj-avatar {
            width: 200px;
            height: 200px;
            border-radius: 50%; /* Se mantiene circular por elegancia, ajustado a medida exacta */
            object-fit: cover;
            background: #111;
            box-shadow: 0 10px 25px rgba(0,0,0,0.4); /* Sombra sutil conservada */
        }

        /* BLOQUE DERECHO: TEXTOS JUSTIFICADOS A LA IZQUIERDA Y EXPANDIDOS */
        .dj-info {
            display: flex;
            flex-direction: column;
            align-items: flex-start; /* Alinea los elementos a la izquierda */
            text-align: left; 
            justify-content: center;
            flex-grow: 1;
            width: calc(100% - 240px); /* Toma el 100% del espacio restante */
            transition: opacity var(--dj-transition), transform var(--dj-transition);
            will-change: opacity, transform;
        }

        /* Contenedor para colocar Badge y Nombre en la misma línea */
        .dj-header-inline {
            display: flex;
            align-items: center;
            flex-wrap: wrap; /* Permite que baje de línea si la pantalla es muy angosta */
            gap: 15px; /* Espacio entre el botón EN CABINA y el Nombre */
            margin-bottom: 12px;
            width: 100%;
        }

        /* Línea 1-A: EN CABINA (A modo de botón parpadeante) */
        .dj-badge {
            background-color: var(--dj-accent);
            color: #ffffff;
            font-size: 11px;
            font-weight: 600;
            letter-spacing: 1.5px;
            padding: 4px 14px;
            border-radius: 20px;
            text-transform: uppercase;
            display: inline-block;
            animation: badge-blink 1.5s infinite ease-in-out;
            white-space: nowrap;
        }

        /* Animación de parpadeo suave */
        @keyframes badge-blink {
            0%, 100% { opacity: 1; box-shadow: 0 0 10px rgba(255, 0, 0, 0.8); }
            50% { opacity: 0.4; box-shadow: 0 0 0px transparent; }
        }

        /* Línea 1-B: Nombre del DJ */
        #dj-name {
            font-size: 20px; /* Ajuste milimétrico para que fluya perfecto al lado del botón */
            margin: 0; /* Sin márgenes para compartir línea */
            font-weight: 600;
            letter-spacing: -0.5px;
            color: #ffffff;
        }
        
        /* Agrega el prefijo "DJ " automáticamente sin tocar el JS */
        #dj-name::before {
            content: 'DJ ';
        }

        /* Línea 2: Frase a 16 puntos, extendida en el bloque disponible */
        #dj-phrase {
            font-size:13pt; /* Tamaño exacto solicitado */
            font-style: italic;
            line-height: 1.5;
            color: #eaeaea;
            margin: 0;
            text-align: left; /* Confirmación de justificado a la izquierda */
            width: 100%;
        }

        /* Comillas sutiles en blanco */
        #dj-phrase::before, #dj-phrase::after {
            content: '"';
            color: #ffffff; /* Modificado a color blanco */
            font-weight: bold;
        }

        /* Loader adaptado a la estética minimalista */
        .dj-loading {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 15px;
            width: 100%;
            padding: 40px 0;
        }

        .spinner {
            width: 45px;
            height: 45px;
            border: 3px solid rgba(255, 255, 255, 0.1);
            border-top-color: var(--dj-accent);
            border-radius: 50%;
            animation: spin 1s infinite linear;
        }

        @keyframes spin { to { transform: rotate(360deg); } }

        /* Responsividad para móviles: Apila los bloques si la pantalla es muy pequeña */
        @media (max-width: 650px) {
            .dj-main-layout {
                flex-direction: column;
                align-items: center; /* Centra el avatar en móviles */
                gap: 25px;
            }
            .dj-visual {
                width: auto;
            }
            #dj-avatar {
                width: 160px; /* Un poco más pequeño en móviles para no desbordar */
                height: 160px;
            }
            .dj-info {
                width: 100%;
                align-items: flex-start;
            }
            .dj-header-inline {
                gap: 10px;
            }
            #dj-name {
                font-size: 22px;
            }
        }

        /* =========================================
           BOTÓN Y MODAL DE COMPARTIR HÍBRIDO
           ========================================= */
        .dj-share-btn {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: #ffffff;
            padding: 6px 16px;
            border-radius: 20px;
            font-size: 11px;
            font-family: 'Poppins', sans-serif;
            cursor: pointer;
            margin-top: 15px;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 600;
        }
        .dj-share-btn:hover {
            background: var(--dj-accent);
            border-color: var(--dj-accent);
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(255, 0, 85, 0.4);
        }
        .dj-share-btn i { font-size: 13px; }

        .share-modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.85); backdrop-filter: blur(10px);
            z-index: var(--z-modal); display: none; align-items: center; justify-content: center;
            opacity: 0; visibility: hidden; transition: all 0.3s ease;
        }
        .share-modal-overlay.active { display: flex; opacity: 1; visibility: visible; }
        .share-modal-content {
            background: #1a1a1a; padding: 30px 25px; border-radius: 16px;
            border: 1px solid rgba(255, 255, 255, 0.1); text-align: center;
            box-shadow: 0 25px 50px rgba(0,0,0,0.8); width: 320px; max-width: 90%;
            position: relative; transform: translateY(20px); transition: transform 0.3s ease;
        }
        .share-modal-overlay.active .share-modal-content { transform: translateY(0); }
        .share-modal-title { font-size: 18px; font-weight: 800; color: #fff; margin-bottom: 20px; text-transform: uppercase; letter-spacing: 1px; }
        .share-btn-grid { display: flex; flex-direction: column; gap: 12px; }
        .s-btn {
            width: 100%; padding: 14px; border-radius: 8px; border: none;
            font-family: 'Poppins', sans-serif; font-weight: 700; color: #fff;
            cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 10px;
            font-size: 14px; transition: transform 0.2s, filter 0.2s; text-transform: uppercase; letter-spacing: 1px;
        }
        .s-btn:hover { transform: translateY(-2px); filter: brightness(1.1); }
        .s-btn.wa { background: #25D366; }
        .s-btn.fb { background: #1877F2; }
        .s-btn.x { background: #000000; border: 1px solid rgba(255,255,255,0.2); }
/* FIN ESTILOS DJ */
</style>
</head>
<body>

<div class="background-blur visual-transition" id="bgBlur"></div>
<div class="splash-screen"><h1>Sintonizando...</h1><div class="spinner"></div></div>

<div class="modal-overlay" id="modalOverlay">
  <div class="modal-content">
    <button class="modal-close" onclick="closeModal()"><i class="fas fa-times"></i></button>
    <div class="modal-title" id="modalArtist">Artista</div>
    <div class="modal-subtitle" id="modalTitle">Canción</div>
    <div class="modal-body" id="modalBio">Cargando información...</div>
    <div class="modal-meta"><div>Álbum<span id="modalAlbum">--</span></div><div>Género<span id="modalGenre">--</span></div></div>
  </div>
</div>

<div class="modal-overlay" id="reqModalOverlay">
  <div class="modal-content">
    <button class="modal-close" onclick="closeReqModal()"><i class="fas fa-times"></i></button>
    <div class="modal-title">PIDE TU CANCIÓN</div>
    <div class="modal-subtitle">BUSCA EN NUESTRO CATÁLOGO</div>
    <div class="req-form-group">
        <label class="req-label">Buscar Canción o Artista</label>
        <input type="text" id="reqSearchInput" class="req-input" placeholder="Ej: Madonna, Queen..." />
        <div id="reqSearchResults" class="req-search-results"></div>
    </div>
    <div id="reqStep2" style="display:none; border-top: 1px solid #333; padding-top: 15px;">
        <p style="font-size: 14px; color: #fff; margin-bottom: 10px;">Seleccionaste: <strong id="selectedSong" style="color: var(--color-accent-blue);">--</strong></p>
        <div class="req-form-group"><label class="req-label">Tu Nombre (Opcional)</label><input type="text" id="reqSender" class="req-input" maxlength="127" placeholder="Tu nombre" /></div>
        <div class="req-form-group"><label class="req-label">Dedicado Para (Opcional)</label><input type="text" id="reqDedication" class="req-input" maxlength="127" placeholder="Para..." /></div>
        <div class="req-form-group"><label class="req-label">Tu Email (Opcional)</label><input type="email" id="reqEmail" class="req-input" maxlength="127" placeholder="email@ejemplo.com" /></div>
        <button type="button" class="req-submit" onclick="submitRequest()"><i class="fas fa-paper-plane"></i> ENVIAR PEDIDO</button>
    </div>
    <form class="cc_request_form" data-username="robinson" id="realCentovaForm">
        <div data-type="result" id="centovaResult"></div>
        <input type="text" name="request[artist]" /><input type="text" name="request[title]" /><input type="text" name="request[dedication]" /><input type="text" name="request[sender]" /><input type="text" name="request[email]" /><input type="button" value="Enviar" data-type="submit" id="realSubmitBtn" />
    </form>
  </div>
</div>

<header>
    <img src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgHUtTEFGPRbqVpElB4IrEaW0Y4DJb6_wZwOS24Ns35md-ptU1l8644raWJ67ASFkb3c5gtQQR__wCoE3NNDwO76jBHve4H63CCySYCH3E49e_o-ANQHjSxXHD6cTnPeNUTzaomI14wmXOz-_s7-LzpKV8gOKCyRJJm26_h1fIBrAMjoCt-_dbet-7cH-0E/s16000/radiochar%2012.png" alt="Radiochar Logo" class="radio-logo" referrerpolicy="no-referrer">
</header>

<main>
    <section class="radio-container" aria-label="Reproductor de Radio">
      <div class="cover">
        <button id="wikiBtn" class="wiki-btn" title="Ver reseña" onclick="openInfoModal()"><i class="fas fa-info"></i></button>
        <div id="albumYear" class="album-year-badge visual-transition"></div>
        <img id="albumArt" class="visual-transition" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgLNh9EesljZjOf9Wd4kxbj_a-I04zgQmfpM1gcDbEF6PXkq7CtZ-71Kgc8TwALbpRGi3EDbTIjTEI1N5QRDDXqD6QhV3UHE79leufBWqZoAxys7KiIcviuxnB-ozdP15EVtEGONWR_ZeHPabjdfUd_X8FkdcoDCtVrNvolF3fQyA8N7eLEoozmI895tiEf/s16000/radiochar-vice.png" alt="Portada" referrerpolicy="no-referrer">
      </div>
      <div class="player">
        <canvas id="winampVis" aria-hidden="true"></canvas>
        <div class="info-wrapper">
          <div class="player-meta-row">
              <div class="live-tag-inline"><div class="live-dot-inline"></div> AL AIRE</div>
              <div class="listener-tag-inline"><i class="fas fa-headphones"></i><span id="listenerCount">--</span></div>
              <div class="meta-separator">|</div>
              <div class="request-link" onclick="openReqModal()">PIDE TU CANCIÓN</div>
              <div class="program-tag-inline"><i class="fas fa-broadcast-tower"></i> <span id="currentProgramDisplay">--</span></div>
          </div>
          <div class="song-title-container"><div id="displayTitle" class="song-title visual-transition">Conectando...</div></div>
          <div id="displayArtist" class="artist-name visual-transition">Radiochar</div>
        </div>
        <div class="timeline-container">
          <div id="currentTime" class="time-display">00:00</div>
          <div class="progress-bar-bg"><div id="progressFill" class="progress-bar-fill"></div></div>
          <div id="totalTime" class="time-display">--:--</div>
        </div>
        <div class="controls-row"><div class="play-btn-wrapper"><button id="playPause" class="play-btn"><i class="fas fa-play"></i></button></div></div>
        <div id="data-source" style="display: none;" aria-hidden="true">
            <div id="trackTitleSource" class="cc_streaminfo" data-type="tracktitle" data-username="robinson"></div>
            <div id="trackArtistSource" class="cc_streaminfo" data-type="trackartist" data-username="robinson"></div>
        </div>
      </div>
    </section>

<!-- INICIO HTML DJ-->
 <section id="virtual-dj-container" class="dj-section-wrapper">
    <!-- Loader inicial -->
    <div id="dj-skeleton" class="dj-loading">
        <div class="spinner"></div>
        <p style="font-size: 10px; opacity: 0.5; letter-spacing: 2px;">SINCRONIZANDO CABINA...</p>
    </div>
    
    <!-- UI Minimalista del DJ (Dos Bloques) -->
    <div class="dj-main-layout">
        
        <!-- Bloque Izquierdo: Imagen FIJA (Ya no tiene el ID que usa el JS) -->
        <div class="dj-visual">
            <img id="dj-avatar" src="" alt="DJ" loading="lazy">
        </div>
        
        <!-- Bloque Derecho: TEXTOS ANIMADOS (AQUÍ le pusimos el id="dj-content") -->
        <div id="dj-content" class="dj-info hidden">
            <!-- Badge y Título alineados en la misma fila -->
            <div class="dj-header-inline">
                <div class="dj-badge">EN CABINA</div>
                <h3 id="dj-name">---</h3>
            </div>
            
            <p id="dj-phrase">"..."</p>
            
            <!-- Botón de compartir híbrido -->
            <button class="dj-share-btn" onclick="shareCurrentTrack()" aria-label="Compartir">
                <i class="fas fa-share-alt"></i> Compartir
            </button>
            
            <!-- Elemento Oculto: Recibe el dato de la canción sin romper el diseño -->
            <span id="current-track" style="display: none;"></span>
        </div>
        
    </div>
</section>
<!-- FIN HTML DJ -->

    <section class="content-section schedule-section">
      <div class="section-header-common"><h2 class="section-title-common schedule-title-custom">ESTAMOS PRESENTANDO</h2></div>
      <div class="schedule-container-custom" id="scheduleSlider">
         <div class="slider-arrow left" id="schedPrev"><i class="fas fa-chevron-left"></i></div>
         <div class="slider-arrow right" id="schedNext"><i class="fas fa-chevron-right"></i></div>
         <div class="schedule-track" id="scheduleTrack"></div>
      </div>
    </section>

    <section class="content-section recent-tracks-container">
        <div class="section-header-common"><h2 class="section-title-common recent-tracks-title-custom">LAS ÚLTIMAS QUE SONARON</h2></div>
        <div class="carousel-wrapper-common">
            <div class="slider-arrow left" id="recentTracksPrev"><i class="fas fa-chevron-left"></i></div>
            <div class="slider-arrow right" id="recentTracksNext"><i class="fas fa-chevron-right"></i></div>
            <div class="carousel-track-common" id="recentTracksTrack">
                <div style="color: #aaa; padding: 20px; text-align: center; width:100%;">Cargando historial...</div>
            </div>
        </div>
    </section>

    <section class="content-section slogan-section">
        <h2 class="slogan-text">LA EMISORA ONLINE <p style="color: yellow; display: inline;">#1</p> EN LATINOAMÉRICA</h2>
        <h3 class="sub-slogan">TRANSMITIENDO 24/7 DESDE <p style="color: yellow; display: inline;">2011</p> EN HD</h3>
    </section>

    <section class="content-section top-chart-section">
        <div class="section-header-common"><h2 class="section-title-common topchart-title-custom" id="topChartTitle">TOP 10 DEL DÍA</h2></div>
        <div class="top10-layout" id="topChartContainer">
            <div class="top10-featured" id="top10Featured"><div style="color: #aaa; padding: 20px;">Cargando Hit #1...</div></div>
            <div class="top10-list-container" id="top10List"><div style="color: #aaa; padding: 20px;">Cargando lista...</div></div>
        </div>
    </section>

    <section class="content-section did-you-know-container" id="didYouKnowContainer" style="display: none;">
        <div class="section-header-common"><h2 class="section-title-common dyk-title-custom">SABÍAS QUE...</h2></div>
        <article id="dykContent" class="feature-card">
            <div class="feature-image-wrapper"><div class="feature-badge badge-pink">El Dato</div><img src="" class="feature-image" id="dykCover" alt="Cover"></div>
            <div class="feature-content">
                <div class="feature-headline" id="dykTitle">Cargando...</div>
                <div class="feature-subhead" id="dykArtist"></div>
                <div class="feature-meta"><div id="dykAlbum"><i class="fas fa-compact-disc"></i> <span>--</span></div><div id="dykYear"><i class="fas fa-calendar-alt"></i> <span>--</span></div></div>
                <div class="feature-text" id="dykText">Buscando datos interesantes...</div>
            </div>
        </article>
    </section>

    <section class="content-section repository-section-container">
        <div class="section-header-common"><h2 class="section-title-common repo-title-custom">REPOSITORIO MUSICAL</h2></div>
        <div class="repo-grid">
            <a href="https://www.worldradiohistory.com/index.htm" target="_blank" class="repo-card">
                <div class="repo-image-wrapper"><img src="https://www.radioheritage.com/wp-content/uploads/2020/07/WorldRadioHistory-screenshot.jpg" alt="World Radio Story" class="repo-image"></div>
                <div class="repo-content"><h3 class="repo-card-title">World Radio Story</h3><p class="repo-card-desc">Más de 140.000 documentos y publicaciones.</p></div>
            </a>
            <a href="https://www.rockmusictimeline.com" target="_blank" class="repo-card">
                <div class="repo-image-wrapper"><img src="https://storage.googleapis.com/wzsitethumbnails/site-48980609/800x500.jpg" alt="Rock Music Time" class="repo-image"></div>
                <div class="repo-content"><h3 class="repo-card-title">Rock Music Time</h3><p class="repo-card-desc">Una cronología en línea de la historia del Rock And Roll.</p></div>
            </a>
            <a href="https://www.billboard.com/charts" target="_blank" class="repo-card">
                <div class="repo-image-wrapper"><img src="https://www.billboard.com/wp-content/uploads/media/billboard-charts-logo-2018-billboard-1548.jpg" alt="Billboard Charts" class="repo-image"></div>
                <div class="repo-content"><h3 class="repo-card-title">Billboard Charts</h3><p class="repo-card-desc">Listas de éxitos musicales más populares.</p></div>
            </a>
        </div>
    </section>
    
    <section class="content-section directories-section-container">
        <div class="section-header-common"><h2 class="section-title-common directories-title-custom">DISPONIBLE EN DIRECTORIOS</h2></div>
        <div class="carousel-wrapper-common">
            <div class="slider-arrow left" id="directoriesPrev"><i class="fas fa-chevron-left"></i></div>
            <div class="slider-arrow right" id="directoriesNext"><i class="fas fa-chevron-right"></i></div>
            <div class="carousel-track-common" id="directoriesTrack">
				<a href="https://www.getmeradio.com/stations/radiochar-11470/" target="_blank" class="directory-card"><div class="directory-logo-wrap"><img src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhp-GTg6Hb14M_ZLaFlZnkMaT0LkMmYPYPxGx1G_mezigt_JHoZyXdshlj4_tPVv79uftLUskRJPSor0YJwxsap0NoIlqDq368sUpUgEgSMEPxitK9ktyUAJyW582ozNjKdo_w0Qxuj2RG82vg5qAiG9GsrysMcCN-eXKy_jCIFSjcPQ1iKACfvBdPiyb5L/s300/GetMeRadio.png" alt="Get Me Radio"></div><div class="directory-name">Get Me Radio</div></a>
                <a href="https://forwardmystream.com/station/radiochar" target="_blank" class="directory-card"><div class="directory-logo-wrap"><img src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiSWNNZIAGbnOPGKEPyVTzsIaaRzniqoU9cEdC4iwlBnLIMBKeGBZogMGUU0RKK0s2MC0d2emRjKVonc23mKSPXSBu84Fs2byEA89VOTnlonf9god3RXs4ziQ9GEI72i_2IvAt3lr2_cxJdsBRpAWTwGTMwbp3sYnyYsX4r1IQ2YjjG33ZDLskLxTQlcZs1/s1600/ForwardMyStream.png" alt="Forward My Stream"></div><div class="directory-name">Forward My Stream</div></a>
                <a href="https://theonestopradio.com/radio/radiochar%20co" target="_blank" class="directory-card"><div class="directory-logo-wrap"><img src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhIk_IUagLJ5h6UYoFUcaCveJ-iDfGsYayy63caTzNQKOM_5lubkZvpONuZenvm0BK62dohkoZhWTF99ZTQwJNQJ-7yX0tatTgC3dAZQZ_La7breT9daLTQKrsn6WM9DLxFz4N5NV7Fu_ZdVwtkne05V-E9qLQpZQnVRXLCz1-Vgftb1vgzDSQifcn-c0bR/s1600/TheOneStopRadio.png" alt="The OneStop Radio"></div><div class="directory-name">The OneStop Radio</div></a>
                <a href="http://tun.in/sfKBJ" target="_blank" class="directory-card"><div class="directory-logo-wrap"><img src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhxPhIPia7P4pYMXosrf5d5CfqqNfX08wWGebiC4haJsbte021F2AVfd12PrKjbalBC1d-ewSoA7fFVeYIkCLrHm80nu4lhBfzm0PFYuhjpZk6gdFg6Mx-Bl5iQbyWpt3eDvq-ze1ewT5Vx6qv0Osy5nNFtvwgJWrg0yeD7VlVMWvVQ4OZH8HFd-K8CvaPK/s16000/logo%20tunein%20color.png" alt="Tunein"></div><div class="directory-name">TuneIn</div></a>
                <a href="https://mytuner-radio.com/radio/radiochar-514035/" target="_blank" class="directory-card"><div class="directory-logo-wrap"><img src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgnioQJBDi-nzHfdkEmfjo3Q6bSEt7q6qYJk0O5mzXby7Zluv-5fI_b5LPiVOH1S3uRMGCNKGCN3oTseGcFIDaC9leVi5f5EGt43Narxc48MDZGtP_VV7ifbiVst-DByLdz0mjkFbj710O5Ru8NEm8NsPO-e1vPnG4f9BCCcYTFgnlccvEi_zZbo-Et6WtA/s1600/logo%20mytuner%20color.png" alt="MyTuner"></div><div class="directory-name">MyTuner</div></a>
                <a href="https://onlineradiobox.com/co/radiochar" target="_blank" class="directory-card"><div class="directory-logo-wrap"><img src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEir-HbCUabt3Jm5QUfKOQZsc1b3VRCfKpcbCWAjnPUZqIfb2rRaMUKrCXCF6S-ZvT6FQmj9FRYDZM_SyCAqxD-Zadfgwu5Cgg-kXQZRFjpvfP2J_G4FS4J6hMmQcj-MRtAMFvzxbtClpVrdgF2nfm9W-U1inZNvf_kQY1xdX5VYEh8MU9dNKOfO0kb83c1y/s1600/logo%20onlineradiobox%20color.png" alt="Online Radio Box"></div><div class="directory-name">Radio Box</div></a>
		        <a href="https://www.radio.net/s/radiochar" target="_blank" class="directory-card"><div class="directory-logo-wrap"><img src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhYNZwPLx_VygFzysh9hAK6RVQvFqhiIqDP1KHEALTiNgK1pUcRdZEdWhWElK35zFQMwiWz-KiMLEUyYJfpeAkS0iQxdpC8JNP9Ox8kXQniQBvD_xN3tGOGWByRpkt8T4Me005LYQzMAPYmog8LbGobqnJSRh4kCSpBGAZlqJlIgynHPCOPv-s3aI6bl9GN/s16000/logo%20radionet%20color.png" alt="Radio.net"></div><div class="directory-name">Radio.net</div></a>
                <a href="https://www.emisorascolombianas.co/radiochar" target="_blank" class="directory-card"><div class="directory-logo-wrap"><img src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEg4tgA98MOTW8Jg9VLB8ffw1AzyRGfJmXkA_psX8pUP4WdjuCoNXgRQn_QROUc1YKfA45ksGckzRIEftcq_aQEgJJ9LOh5MXogP8_Fun0EZehgd8wq4yE-Ee8IsqibkjuMkbZ0efbDRjVAnKX4FA7UrMzEA8THLAS8tJ3HyJTPXdgzl-EHKwiaoF1hmXrHL/s300/emisoras-colombianas.png" alt="Emisoras Colombianas"></div><div class="directory-name">Emisoras Colombianas</div></a>
                <a href="https://es.streema.com/radios/Radiochar" target="_blank" class="directory-card"><div class="directory-logo-wrap"><img src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEj_LNIAYVHF3yB3prLtWRNLmDoLaBkeTHyMKcFyvSpW9kZkzUIU3sofTKXJyBxCeWSmC-G6HTTIHLQRDgE2nWxlm8aPPiaZnBGicc_4ygXQFwfM9C8I8nzjxCPUKQYZASvT_1O_oPf9J79wJ5TYkXNxVegptqIcE6rq-R6sXaX_qC6Zh2gWqaYdpfCn28BB/s300/streema.png" alt="Streema"></div><div class="directory-name">Streema</div></a>    
			</div>
        </div>
    </section>

</main>

<footer class="community-section">
    <h2 class="community-title">ÚNETE A NUESTRA COMUNIDAD</h2>
    <div class="buttons-container">
        <a href="https://www.facebook.com/Radiochar/" target="_blank" class="btn-social btn-facebook">Síguenos en Facebook</a>
        <a href="https://x.com/radiocharonline" target="_blank" class="btn-social btn-x">Síguenos en X</a>
    </div>
    <div class="creator-footer"><span>Powered by</span> <a href="https://www.robinsonchar.online/" target="_blank">robinsonchar</a></div>
</footer>

<div id="cboxbutton" aria-label="Abrir Chat"><i class="fas fa-comment-dots"></i></div>
<div id="cboxwrap"></div>

<!-- Modal Fallback de Compartir (Para PC) -->
<div class="share-modal-overlay" id="shareFallbackModal">
    <div class="share-modal-content">
        <button class="modal-close" onclick="closeShareModal()"><i class="fas fa-times"></i></button>
        <div class="share-modal-title">Compartir</div>
        <div class="share-btn-grid">
            <button onclick="shareToPlatform('wa')" class="s-btn wa"><i class="fab fa-whatsapp"></i> WhatsApp</button>
            <button onclick="shareToPlatform('x')" class="s-btn x"><i class="fab fa-x-twitter"></i> X (Twitter)</button>
            <button onclick="shareToPlatform('fb')" class="s-btn fb"><i class="fab fa-facebook-f"></i> Facebook</button>
        </div>
    </div>
</div>

<audio id="radio" src="https://cast2.my-control-panel.com/proxy/robinson/stream"></audio>

<script>
(function() {
    var itunesCache = window.itunesCache || new Map();
    // OPTIMIZACIÓN: CACHÉ EN SESSIONSTORAGE
    var CACHE_KEY = 'radiochar_api_cache';
    var sessionCache = {};
    try {
        var stored = sessionStorage.getItem(CACHE_KEY);
        if(stored) sessionCache = JSON.parse(stored);
    } catch(e) {}

    var saveToCache = function(key, data) {
        sessionCache[key] = { data: data, time: Date.now() };
        try { sessionStorage.setItem(CACHE_KEY, JSON.stringify(sessionCache)); } catch(e) {}
    };

    var getFromCache = function(key) {
        var item = sessionCache[key];
        // 24 horas de validez para datos estáticos
        if (item && (Date.now() - item.time < 86400000)) return item.data;
        return null;
    };

    var DB_URL = "https://robinsonchar.github.io/radiochar-bd/LISTADO%20COMPLETO%20DE%20CANCIONES%20DE%20RADIOCHAR.json";
    var DEFAULT_COVER_IMG = "https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgLNh9EesljZjOf9Wd4kxbj_a-I04zgQmfpM1gcDbEF6PXkq7CtZ-71Kgc8TwALbpRGi3EDbTIjTEI1N5QRDDXqD6QhV3UHE79leufBWqZoAxys7KiIcviuxnB-ozdP15EVtEGONWR_ZeHPabjdfUd_X8FkdcoDCtVrNvolF3fQyA8N7eLEoozmI895tiEf/s16000/radiochar-vice.png";

    var lastSongKey = "";
    var lastDykId = "";

    var CONFIG = {
        DEFAULT_COVER: DEFAULT_COVER_IMG,
        ENDPOINTS: {
            RECENT_FEED: 'https://cast2.my-control-panel.com/recentfeed/robinson/json/',
            ITUNES: 'https://itunes.apple.com/search',
            WIKI_SEARCH: 'https://es.wikipedia.org/w/api.php',
            WIKI_SUMMARY: 'https://es.wikipedia.org/api/rest_v1/page/summary/'
        },
        FILTERS: ['pisa', 'pisacanciones', 'jingle', 'promo', 'indicativo', 'sello', 'intro', 'podcast', 'comercial', 'cuña', 'radiochar'],
        REFRESH_RATE_MS: 60000 
    };

    var HITS_POOL = [
        { artist: "Michael Jackson", title: "Billie Jean" },
        { artist: "Queen", title: "Bohemian Rhapsody" },
        { artist: "Madonna", title: "Like a Prayer" },
        { artist: "Guns N' Roses", title: "Sweet Child O' Mine" },
        { artist: "Bon Jovi", title: "Livin' on a Prayer" },
        { artist: "A-ha", title: "Take on Me" },
        { artist: "Eurythmics", title: "Sweet Dreams (Are Made of This)" },
        { artist: "Cyndi Lauper", title: "Girls Just Want to Have Fun" },
        { artist: "The Police", title: "Every Breath You Take" },
        { artist: "U2", title: "With or Without You" }
    ];

    var DOM = {
        audio: document.getElementById('radio'),
        playBtn: document.getElementById('playPause'),
        playIcon: document.querySelector('#playPause i'),
        sourceTitle: document.getElementById('trackTitleSource'),
        sourceArtist: document.getElementById('trackArtistSource'),
        displayTitle: document.getElementById('displayTitle'),
        displayArtist: document.getElementById('displayArtist'),
        albumArt: document.getElementById('albumArt'),
        bgBlur: document.getElementById('bgBlur'),
        albumYear: document.getElementById('albumYear'),
        currentTime: document.getElementById('currentTime'),
        totalTime: document.getElementById('totalTime'),
        progressFill: document.getElementById('progressFill'),
        modal: {
            overlay: document.getElementById('modalOverlay'),
            artist: document.getElementById('modalArtist'),
            title: document.getElementById('modalTitle'),
            bio: document.getElementById('modalBio'),
            album: document.getElementById('modalAlbum'),
            genre: document.getElementById('modalGenre')
        },
        reqModal: {
            overlay: document.getElementById('reqModalOverlay'),
            input: document.getElementById('reqSearchInput'),
            results: document.getElementById('reqSearchResults'),
            step2: document.getElementById('reqStep2'),
            selectedDisplay: document.getElementById('selectedSong')
        },
        canvas: document.getElementById('winampVis'),
        recentGrid: document.getElementById('recentTracksGrid'),
        dyk: {
            container: document.getElementById('didYouKnowContainer'),
            cover: document.getElementById('dykCover'),
            title: document.getElementById('dykTitle'),
            artist: document.getElementById('dykArtist'),
            album: document.getElementById('dykAlbum'),
            year: document.getElementById('dykYear'),
            text: document.getElementById('dykText')
        },
        schedule: {
            track: document.getElementById('scheduleTrack'),
            prev: document.getElementById('schedPrev'),
            next: document.getElementById('schedNext')
        },
        recentTracks: {
            track: document.getElementById('recentTracksTrack'),
            prev: document.getElementById('recentTracksPrev'),
            next: document.getElementById('recentTracksNext')
        },
        directories: {
            track: document.getElementById('directoriesTrack'),
            prev: document.getElementById('directoriesPrev'),
            next: document.getElementById('directoriesNext')
        }
    };

    // Funciones expuestas a window
    window.selectSong = function(artist, title) {
        DOM.reqModal.selectedDisplay.innerText = title + " - " + artist;
        DOM.reqModal.step2.style.display = 'block';
        DOM.reqModal.results.style.display = 'none';
        document.querySelector('input[name="request[artist]"]').value = artist;
        document.querySelector('input[name="request[title]"]').value = title;
    };

    window.submitRequest = function() {
        document.getElementById('realSubmitBtn').click();
        var btn = document.querySelector('.req-submit');
        btn.innerHTML = '<i class="fas fa-check"></i> ENVIADO';
        btn.style.background = '#39ff14';
        setTimeout(function() { closeReqModal(); btn.innerHTML = '<i class="fas fa-paper-plane"></i> ENVIAR PEDIDO'; btn.style.background = ''; DOM.reqModal.input.value = ''; DOM.reqModal.step2.style.display = 'none'; }, 2000);
    };

    window.openReqModal = function() { DOM.reqModal.overlay.classList.add('active'); };
    window.closeReqModal = function() { DOM.reqModal.overlay.classList.remove('active'); };
    window.closeModal = function() { DOM.modal.overlay.classList.remove('active'); };

    var Utils = {
        debounce: function(func, wait) {
            var timeout;
            return function() {
                var context = this, args = arguments;
                clearTimeout(timeout);
                timeout = setTimeout(function() { func.apply(context, args); }, wait);
            };
        },
        cleanText: function(text) {
            if (!text) return "";
            return text.replace(/^\d+\.?\s*-?/, "").replace(/\(.*\)/g, "").replace(/\[.*\]/g, "").replace(/ft\..*/i, "").replace(/feat\..*/i, "").replace(/remix/i, "").replace(/original mix/i, "").replace(/extended/i, "").replace(/radio edit/i, "").trim();
        },
        formatTime: function(seconds) {
            var m = Math.floor(seconds / 60);
            var s = Math.floor(seconds % 60);
            return (m < 10 ? '0'+m : m) + ":" + (s < 10 ? '0'+s : s);
        },
        toTitleCase: function(str) {
            if(!str) return "";
            return str.toLowerCase().split(' ').map(function(w) { return w.charAt(0).toUpperCase() + w.slice(1); }).join(' ');
        },
        smartLimitText: function(text, maxWords) {
            if (!text) return "";
            var words = text.trim().split(/\s+/);
            if (words.length <= maxWords) return text;
            return words.slice(0, maxWords).join(" ") + "...";
        },
        truncateToSentence: function(text, maxChars) {
            if (!text) return "";
            if (text.length <= maxChars) return text;
            var sub = text.substr(0, maxChars);
            var lastDot = sub.lastIndexOf(".");
            if (lastDot > maxChars * 0.5) return sub.substr(0, lastDot + 1);
            var lastSpace = sub.lastIndexOf(" ");
            if (lastSpace > -1) return sub.substr(0, lastSpace) + "..."; 
            return sub + "..."; 
        },
        safeFetchJson: async function(url) {
            // CACHE CHECK FOR URL
            var cached = getFromCache(url);
            if(cached) return cached;
            
            try {
                var res = await fetch(url);
                if (!res.ok) return null;
                var data = await res.json();
                saveToCache(url, data); // Guardar en sesión
                return data;
            } catch (e) { return null; }
        },
        getColombiaDate: function() {
            var options = { timeZone: "America/Bogota", year: 'numeric', month: '2-digit', day: '2-digit' };
            var formatter = new Intl.DateTimeFormat('en-CA', options);
            var parts = formatter.formatToParts(new Date());
            var year = parseInt(parts.find(p => p.type === 'year').value);
            var month = parseInt(parts.find(p => p.type === 'month').value) - 1; 
            var day = parseInt(parts.find(p => p.type === 'day').value);
            var current = Date.UTC(year, month, day);
            var start = Date.UTC(2023, 0, 1);
            var daysPassed = Math.floor((current - start) / (1000 * 60 * 60 * 24));
            // AYER
            var yesterday = new Date(current);
            yesterday.setDate(yesterday.getDate() - 1);
            var yDay = yesterday.getUTCDate().toString().padStart(2,'0');
            var yMonth = (yesterday.getUTCMonth() + 1).toString().padStart(2,'0');
            var yYear = yesterday.getUTCFullYear();
            return {
                str: yDay + "/" + yMonth + "/" + yYear,
                seed: daysPassed
            };
        },
        seededRandom: function(seed) {
            var s = seed % 2147483647;
            if (s <= 0) s += 2147483646;
            return function() {
                s = (s * 16807) % 2147483647;
                return (s - 1) / 2147483646;
            };
        }
    };

    DOM.reqModal.input.addEventListener('input', Utils.debounce(async function(e) {
        var term = e.target.value.trim();
        if (term.length < 3) { DOM.reqModal.results.style.display = 'none'; return; }
        var data = await Utils.safeFetchJson(CONFIG.ENDPOINTS.ITUNES + "?term=" + encodeURIComponent(term) + "&media=music&entity=song&limit=10");
        if (data && data.results.length > 0) {
            var html = '';
            data.results.forEach(function(track) {
                html += '<div class="req-item" onclick="selectSong(\'' + track.artistName.replace(/'/g, "\\'") + '\', \'' + track.trackName.replace(/'/g, "\\'") + '\')">' +
                    '<img src="' + track.artworkUrl100 + '" alt="cover">' +
                    '<div class="req-item-info"><span class="req-item-title">' + track.trackName + '</span><span class="req-item-artist">' + track.artistName + '</span></div>' +
                '</div>';
            });
            DOM.reqModal.results.innerHTML = html;
            DOM.reqModal.results.classList.add('active');
            DOM.reqModal.results.style.display = 'block';
        } else { DOM.reqModal.results.style.display = 'none'; }
    }, 500));

    DOM.reqModal.overlay.addEventListener('click', function(e) { if (e.target === DOM.reqModal.overlay) closeReqModal(); });
    DOM.modal.overlay.addEventListener('click', function(e) { if (e.target === DOM.modal.overlay) closeModal(); });

    // === CBOX ENGINE (V26.0 - ZERO-GAP PROTOCOL) ===
    document.addEventListener('DOMContentLoaded', function() {
        var cboxBtn = document.getElementById('cboxbutton');
        var cboxWrap = document.getElementById('cboxwrap');
        
        if (cboxBtn && cboxWrap) {
            // Inicializar icono CBOX manualmente
            cboxBtn.innerHTML = '<i class="fas fa-comment-dots"></i>';
            
            var isCboxOpen = false;
            var isCboxLoaded = false;
            
            cboxBtn.addEventListener('click', function() {
                isCboxOpen = !isCboxOpen;

                if (isCboxOpen) {
                    cboxWrap.style.display = 'block';
                    cboxBtn.innerHTML = '<i class="fas fa-times"></i>'; 
                    
                    if (!isCboxLoaded) {
                        cboxWrap.innerHTML = 
                        '<div id="cboxdiv">' +
                            '<div class="cbox-main-wrapper">' +
                                '<iframe src="https://www4.cbox.ws/box/?boxid=3774862&boxtag=a7lslt&sec=main" marginheight="0" marginwidth="0" frameborder="0" scrolling="auto" allowtransparency="yes" name="cboxmain4-3774862" id="cboxmain4-3774862" class="cbox-frame-main"></iframe>' +
                            '</div>' +
                            '<div class="cbox-form-wrapper">' +
                                '<iframe src="https://www4.cbox.ws/box/?boxid=3774862&boxtag=a7lslt&sec=form" allow="autoplay" marginheight="0" marginwidth="0" frameborder="0" scrolling="no" allowtransparency="yes" name="cboxform4-3774862" id="cboxform4-3774862" class="cbox-frame-form"></iframe>' +
                            '</div>' +
                        '</div>';
                        isCboxLoaded = true;
                    }
                } else {
                    cboxWrap.style.display = 'none';
                    cboxBtn.innerHTML = '<i class="fas fa-comment-dots"></i>'; 
                }
            });
        }
        
        loadDatabase();
        setTimeout(function() {
            var splash = document.querySelector('.splash-screen');
            if(splash) {
                splash.style.opacity = '0';
                setTimeout(function() { splash.remove(); }, 1000);
            }
        }, 2000);
        
        // V29.0: NEW DIRECTORIES CAROUSEL INIT
        if (DOM.directories.prev && DOM.directories.next && DOM.directories.track) {
            DOM.directories.prev.addEventListener('click', function() { DOM.directories.track.scrollBy({ left: -270, behavior: 'smooth' }); });
            DOM.directories.next.addEventListener('click', function() { DOM.directories.track.scrollBy({ left: 270, behavior: 'smooth' }); });
        }
    });

    // ... Rest of the script logic (Schedule, Player, etc.) REMAINS THE SAME ...
    var ScheduleEngine = {
        programs: [
            { id: 'lover', title: 'LOVER CITY', subtitle: 'BALADAS AMERICANAS', start: 0, end: 6, img: 'https://mickpini.com/wp-content/uploads/2025/07/1.png', displayTime: '00:00 - 05:59 (GMT-5)' },
            { id: 'wonders', title: 'THE WONDERS', subtitle: 'LOS 90S', start: 6, end: 12, img: 'https://wallpapers.com/images/hd/90s-theme-background-fdllcnh7s97z4qio.jpg', displayTime: '06:00 - 11:59 (GMT-5)' },
            { id: 'tirando', title: 'PATEANDO PIEDRAS', subtitle: 'ROCK & POP EN ESPAÑOL', start: 12, end: 15, img: 'https://dojiw2m9tvv09.cloudfront.net/36300/product/los-rodriguez-vinilo-89039.jpg', displayTime: '12:00 - 14:59 (GMT-5)' },
            { id: 'rockstars', title: 'ROCKSTARS', subtitle: 'ROCK DE LOS 80S', start: 15, end: 20, img: 'https://i0.wp.com/lashistoriasdelrock.com/wp-content/uploads/2024/06/Son-10-Canciones-de-Rock-Mas-Emblematicas-de-los-80s.jpg', displayTime: '15:00 - 19:59 (GMT-5)' },
            { id: 'hits_lie', title: 'HITS DON´T LIE', subtitle: 'HITS 80S/90S', start: 20, end: 24, img: 'https://djhire.melbourne/wp-content/uploads/2024/11/Bon-Jovi-80s.png', displayTime: '20:00 - 23:59 (GMT-5)' }
        ],
        init: function() {
            if(!DOM.schedule.track) return;
            var schedule = this.getTodaySchedule();
            new InfiniteTimelineSlider(DOM.schedule.track, DOM.schedule.prev, DOM.schedule.next, schedule);
            this.updatePlayerLabel(schedule);
            setInterval(function() { this.updatePlayerLabel(schedule); }.bind(this), 60000); 
        },
        getTodaySchedule: function() { return JSON.parse(JSON.stringify(this.programs)); },
        updatePlayerLabel: function(schedule) {
            var now = new Date().getHours();
            var activeProg = schedule.find(function(p) { return now >= p.start && now < p.end; });
            if(activeProg) document.getElementById('currentProgramDisplay').innerText = activeProg.title;
        }
    };

    class InfiniteTimelineSlider {
        constructor(track, prevBtn, nextBtn, items) {
            this.track = track;
            this.prevBtn = prevBtn;
            this.nextBtn = nextBtn;
            this.originalItems = items;
            this.itemCount = items.length;
            var now = new Date().getHours();
            this.realIndex = items.findIndex(function(p) { return now >= p.start && now < p.end; });
            if(this.realIndex === -1) this.realIndex = 0;
            this.render();
            this.initListeners();
        }
        render() {
            var html = '';
            var self = this;
            this.originalItems.forEach(function(prog) { html += self.createCardHtml(prog, false); });
            this.originalItems.forEach(function(prog) { html += self.createCardHtml(prog, true); });
            this.originalItems.forEach(function(prog) { html += self.createCardHtml(prog, false); });
            this.track.innerHTML = html;
            this.currentIndex = this.itemCount + this.realIndex;
            setTimeout(function() { self.updateCardWidth(); self.updatePosition(false); }, 50);
        }
        createCardHtml(prog, isReal) {
            return '<div class="schedule-card-item" data-id="' + prog.id + '" data-start="' + prog.start + '" data-end="' + prog.end + '">' +
                '<div class="program-card">' +
                    '<div class="on-air-badge">AL AIRE</div>' +
                    '<img src="' + prog.img + '" class="program-bg" alt="' + prog.title + '" onerror="this.src=\'' + CONFIG.DEFAULT_COVER + '\'">' +
                    '<div class="program-overlay">' +
                        '<div class="program-time">' + prog.displayTime + '</div>' +
                        '<div class="program-title">' + prog.title + '</div>' +
                        '<div class="program-subtitle">' + prog.subtitle + '</div>' +
                    '</div>' +
                '</div>' +
            '</div>';
        }
        initListeners() {
            var self = this;
            this.prevBtn.addEventListener('click', function() { self.slide(-1); });
            this.nextBtn.addEventListener('click', function() { self.slide(1); });
            this.track.addEventListener('transitionend', function() { self.checkIndex(); });
            window.addEventListener('resize', Utils.debounce(function() { self.updateCardWidth(); self.updatePosition(false); }, 200));
        }
        updateCardWidth() {
            var firstCard = this.track.querySelector('.schedule-card-item');
            this.cardWidth = firstCard ? firstCard.offsetWidth : 300;
        }
        slide(dir) {
            this.track.style.transition = 'transform 0.5s cubic-bezier(0.25, 1, 0.5, 1)';
            this.currentIndex += dir;
            this.updatePosition(true);
        }
        updatePosition(animate) {
            var translateX = -(this.currentIndex * this.cardWidth);
            this.track.style.transform = 'translateX(' + translateX + 'px)';
            this.updateVisuals();
        }
        checkIndex() {
            if (this.currentIndex >= this.itemCount * 2) {
                this.track.style.transition = 'none';
                this.currentIndex = this.itemCount; 
                this.updatePosition(false);
            } else if (this.currentIndex < this.itemCount) {
                this.track.style.transition = 'none';
                this.currentIndex = (this.itemCount * 2) - 1; 
                this.updatePosition(false);
            }
        }
        updateVisuals() {
            var cards = this.track.querySelectorAll('.schedule-card-item');
            var now = new Date().getHours();
            var self = this;
            cards.forEach(function(card, idx) {
                if (idx === self.currentIndex) {
                    card.classList.add('active-slide');
                    card.style.opacity = '1';
                    card.style.transform = 'scale(1.1)';
                    card.style.filter = 'blur(0)';
                } else {
                    card.classList.remove('active-slide');
                    card.style.opacity = '0.4';
                    card.style.transform = 'scale(0.9)';
                    card.style.filter = 'blur(2px)';
                }
                var start = parseInt(card.dataset.start);
                var end = parseInt(card.dataset.end);
                if (now >= start && now < end) card.classList.add('is-live'); else card.classList.remove('is-live');
            });
        }
    }

    var isPlaying = false;
    var currentMetadata = { artist: "Radiochar", song: "", album: "", genre: "" };
    var timelineState = { duration: 0, current: 0, start: 0, interval: null };

    document.getElementById('listenerCount').innerText = Math.floor(Math.random() * (50 - 25 + 1) + 25);
    var ctx = DOM.canvas.getContext('2d');
    var BARS = 30;
    var frequencyData = new Array(BARS).fill(0);
    var peakHeights = new Array(BARS).fill(0);

    function animateWinamp() {
        requestAnimationFrame(animateWinamp);
        
        // OPTIMIZACIÓN: NO DIBUJAR SI ESTÁ PAUSADO
        if (!isPlaying) {
             // Limpiar una vez y salir
             ctx.clearRect(0, 0, DOM.canvas.width, DOM.canvas.height);
             return; 
        }

        if (DOM.canvas.width !== DOM.canvas.clientWidth) { DOM.canvas.width = DOM.canvas.clientWidth; DOM.canvas.height = DOM.canvas.clientHeight; }
        ctx.clearRect(0, 0, DOM.canvas.width, DOM.canvas.height);
        
        for(var i=0; i<BARS; i++) frequencyData[i] = Math.random() * 100;
        
        var gap = 3;
        var barWidth = (DOM.canvas.width - (gap * (BARS - 1))) / BARS;
        ctx.fillStyle = 'rgba(255, 255, 255, 0.1)';
        for (var i = 0; i < BARS; i++) {
            var intensity = frequencyData[i] || 0;
            var decay = 1 - (i * 0.05);
            var targetHeight = (intensity / 100) * DOM.canvas.height * decay;
            if (targetHeight > peakHeights[i]) peakHeights[i] = targetHeight; else peakHeights[i] -= 2;
            if (peakHeights[i] < 0) peakHeights[i] = 0;
            var h = peakHeights[i];
            var center = DOM.canvas.width / 2;
            var xOffset = (i * (barWidth + gap)) + (gap/2);
            ctx.fillRect(center - xOffset - barWidth, DOM.canvas.height - h, barWidth, h);
            ctx.fillRect(center + xOffset, DOM.canvas.height - h, barWidth, h);
        }
    }
    
    // Iniciar el loop una vez
    requestAnimationFrame(animateWinamp);

    DOM.playBtn.addEventListener('click', function() {
        if (isPlaying) { 
            DOM.audio.pause(); 
            DOM.playIcon.classList.replace('fa-pause', 'fa-play'); 
            DOM.playBtn.classList.remove('playing'); 
            isPlaying = false;
        } else { 
            DOM.audio.play(); 
            DOM.playIcon.classList.replace('fa-play', 'fa-pause'); 
            DOM.playBtn.classList.add('playing'); 
            isPlaying = true;
            animateWinamp(); // Reiniciar loop
        }
    });

    window.openInfoModal = async function() {
        DOM.modal.overlay.classList.add('active');
        var displayArtist = DOM.displayArtist.innerText;
        var displaySong = DOM.displayTitle.innerText;
        var artist = (currentMetadata.artist && currentMetadata.artist !== "Radiochar") ? currentMetadata.artist : displayArtist;
        var song = (currentMetadata.song && currentMetadata.song !== "") ? currentMetadata.song : displaySong;
        
        DOM.modal.artist.innerText = artist;
        DOM.modal.title.innerText = song;
        DOM.modal.bio.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Buscando información...';
        // FIX: Set innerText directly on the span element (DOM.modal.album is the span)
        DOM.modal.album.innerText = currentMetadata.album || "--";
        DOM.modal.genre.innerText = currentMetadata.genre || "--";

        var cleanTitle = Utils.cleanText(song);
        var query = cleanTitle + " " + artist;
        
        try {
            var searchData = await Utils.safeFetchJson(CONFIG.ENDPOINTS.WIKI_SEARCH + "?action=query&list=search&srsearch=" + encodeURIComponent(query) + "&format=json&origin=*");
            
            if (searchData && searchData.query && searchData.query.search && searchData.query.search.length > 0) {
                var pageTitle = searchData.query.search[0].title;
                var summaryData = await Utils.safeFetchJson(CONFIG.ENDPOINTS.WIKI_SUMMARY + encodeURIComponent(pageTitle));
                if (summaryData && summaryData.extract) { 
                    DOM.modal.bio.innerText = summaryData.extract; 
                } else { 
                    openInfoModalArtistFallback(artist);
                }
            } else { 
                openInfoModalArtistFallback(artist);
            }
        } catch (e) {
             DOM.modal.bio.innerText = "No se encontró información disponible.";
        }
    };

    async function openInfoModalArtistFallback(artist) {
        try {
            var searchData = await Utils.safeFetchJson(CONFIG.ENDPOINTS.WIKI_SEARCH + "?action=query&list=search&srsearch=" + encodeURIComponent(artist) + "&format=json&origin=*");
            if (searchData && searchData.query && searchData.query.search && searchData.query.search.length > 0) {
                var pageTitle = searchData.query.search[0].title;
                var summaryData = await Utils.safeFetchJson(CONFIG.ENDPOINTS.WIKI_SUMMARY + encodeURIComponent(pageTitle));
                if (summaryData && summaryData.extract) { 
                     DOM.modal.bio.innerText = "Información del Artista: " + summaryData.extract;
                } else { DOM.modal.bio.innerText = "Reseña no disponible."; }
            } else { DOM.modal.bio.innerText = "No se encontró información."; }
        } catch(e) { DOM.modal.bio.innerText = "No se encontró información."; }
    }

    function initTimeline(key, durationMillis) {
        clearInterval(timelineState.interval);
        
        var adjustedDuration = (durationMillis && !isNaN(durationMillis) && durationMillis > 0) ? durationMillis : (Math.floor(Math.random() * (240000 - 180000 + 1)) + 180000);
        
        if (adjustedDuration > 480000) adjustedDuration = 240000;
        if (adjustedDuration < 60000) adjustedDuration = 180000;

        var now = Date.now();
        var savedData = {};
        try { savedData = JSON.parse(localStorage.getItem('radioCurrentSong') || '{}'); } catch(e) {}
        
        if (savedData.key === key && savedData.startTime && (now - savedData.startTime < adjustedDuration)) { 
            timelineState.start = savedData.startTime; 
        } else { 
            timelineState.start = now; 
            try { localStorage.setItem('radioCurrentSong', JSON.stringify({ key: key, startTime: now })); } catch(e) {} 
        }
        
        timelineState.duration = adjustedDuration / 1000;
        
        var updateTick = function() {
            var elapsed = (Date.now() - timelineState.start) / 1000;
            var current = elapsed > timelineState.duration ? timelineState.duration : elapsed;
            
            if (DOM.currentTime) DOM.currentTime.innerText = Utils.formatTime(current);
            if (DOM.totalTime) DOM.totalTime.innerText = Utils.formatTime(timelineState.duration);
            if (DOM.progressFill) DOM.progressFill.style.width = ((current / timelineState.duration) * 100) + "%";
        };
        
        updateTick();
        timelineState.interval = setInterval(updateTick, 1000);
    }

    var checkMarquee = Utils.debounce(function() {
        var container = document.querySelector('.song-title-container');
        var title = DOM.displayTitle;
        title.classList.remove('scrolling-text');
        container.classList.remove('is-scrolling');
        title.style.removeProperty('--scroll-distance');
        if (title.scrollWidth > container.offsetWidth) {
            var distance = (title.scrollWidth - container.offsetWidth + 20) * -1;
            title.style.setProperty('--scroll-distance', distance + 'px');
            title.classList.add('scrolling-text');
            container.classList.add('is-scrolling');
        }
    }, 200);

    window.addEventListener('resize', checkMarquee);

    async function updateInfo() {
        if (!DOM.sourceArtist || !DOM.sourceTitle) return;
        var artist = DOM.sourceArtist.innerText.trim();
        var title = DOM.sourceTitle.innerText.trim();
        if (!artist || !title) return;
        
        var formattedArtist = Utils.toTitleCase(artist);
        var uniqueKey = artist + "-" + title; 
        
        currentMetadata.artist = formattedArtist;
        currentMetadata.song = title;
        
        var fullStr = (artist + " " + title).toLowerCase();
        if (CONFIG.FILTERS.some(function(f) { return fullStr.includes(f); })) {
            return; 
        }

        if (uniqueKey === lastSongKey) return;
        lastSongKey = uniqueKey;

        var elementsToFade = [DOM.displayTitle, DOM.displayArtist, DOM.albumArt, DOM.bgBlur, DOM.albumYear];
        elementsToFade.forEach(function(el) { el.classList.add('fading-out'); });

        var cleanTitle = Utils.cleanText(title);
        var newCoverUrl = CONFIG.DEFAULT_COVER;
        var durationMillis = 0; 
        
        var query = encodeURIComponent(artist + ' ' + cleanTitle);
        var term = artist + ' ' + cleanTitle;

        if (itunesCache.has(term)) {
            var cachedData = itunesCache.get(term);
            newCoverUrl = cachedData.url;
            if(cachedData.meta) {
                currentMetadata.album = cachedData.meta.album;
                currentMetadata.genre = cachedData.meta.genre;
                if(cachedData.meta.year) DOM.albumYear.innerText = cachedData.meta.year;
                if(cachedData.meta.duration) durationMillis = cachedData.meta.duration; 
            }
            finishUpdateProcess();
        } else {
            var data = await Utils.safeFetchJson(CONFIG.ENDPOINTS.ITUNES + "?term=" + query + "&media=music&limit=1");
            var meta = {};
            if (data && data.results && data.results.length > 0) {
                var track = data.results[0];
                newCoverUrl = track.artworkUrl100.replace('100x100bb', '600x600bb');
                meta = {
                    album: track.collectionName,
                    genre: track.primaryGenreName,
                    year: track.releaseDate ? track.releaseDate.substring(0, 4) : "",
                    duration: track.trackTimeMillis 
                };
                currentMetadata.album = meta.album;
                currentMetadata.genre = meta.genre;
                if (meta.year) DOM.albumYear.innerText = meta.year;
                if (meta.duration) durationMillis = meta.duration;
            }
            itunesCache.set(term, { url: newCoverUrl, meta: meta });
            finishUpdateProcess();
        }

        function finishUpdateProcess() {
            setTimeout(function() {
                DOM.displayTitle.innerText = title;
                DOM.displayArtist.innerText = formattedArtist;
                
                var imgLoader = new Image();
                var showNewContent = function() {
                     DOM.albumArt.src = newCoverUrl;
                     if (newCoverUrl === CONFIG.DEFAULT_COVER) {
                         DOM.bgBlur.style.backgroundImage = 'url("' + CONFIG.DEFAULT_COVER + '")';
                     } else {
                         DOM.bgBlur.style.backgroundImage = 'url("' + newCoverUrl + '")';
                     }
                     
                     initTimeline(uniqueKey, durationMillis);
                     checkMarquee();
                     
                     setTimeout(function() { elementsToFade.forEach(function(el) { el.classList.remove('fading-out'); }); }, 50); 
                     loadRecentTracks();
                };
                imgLoader.onload = showNewContent;
                imgLoader.onerror = function() { newCoverUrl = CONFIG.DEFAULT_COVER; showNewContent(); };
                imgLoader.src = newCoverUrl;
            }, 600); 
        }
    }

    var observer = new MutationObserver(function(mutations) {
        if(mutations.some(function(m) { return m.type === 'characterData' || m.type === 'childList'; })) {
            if(DOM.sourceTitle && DOM.sourceTitle.innerText.trim() !== "") { Utils.debounce(updateInfo, 500)(); }
        }
    });
    if(DOM.sourceTitle) observer.observe(DOM.sourceTitle, { childList: true, characterData: true, subtree: true });

    async function loadDatabase() {
        var cacheBuster = "?v=" + new Date().getTime();
        var targetUrl = DB_URL + cacheBuster;

        try {
            var response = await fetch(targetUrl);
            if (response.ok) {
                var text = await response.text();
                var songs = [];
                if (text.trim().startsWith('[')) {
                     try { songs = JSON.parse(text); } catch(e) {}
                }
                if (Array.isArray(songs) && songs.length > 0) {
                    songs = songs.map(function(s) {
                        if (typeof s === 'string') {
                             var p = s.split('-');
                             return { artist: p[0] ? p[0].trim() : "Desconocido", title: p.slice(1).join('-').trim() || "Desconocido" };
                        }
                        return s;
                    });
                    generateDailyTop10(songs);
                    generateRandomDidYouKnow(songs); 
                    return; 
                }
            }
        } catch (e) { console.warn("Fallo carga DB externa, usando backup.", e); }
        generateDailyTop10(HITS_POOL);
    }

    function generateDailyTop10(songPool) {
        var bogotaData = Utils.getColombiaDate();
        var titleContainer = document.getElementById('topChartTitle');
        if (titleContainer) titleContainer.innerText = "TOP 10 DE AYER " + bogotaData.str;

        var masterSeed = 2024 + songPool.length; 
        var masterRng = Utils.seededRandom(masterSeed);
        
        var shuffledPool = [].concat(songPool);
        for (var i = shuffledPool.length - 1; i > 0; i--) {
            var j = Math.floor(masterRng() * (i + 1));
            var temp = shuffledPool[i];
            shuffledPool[i] = shuffledPool[j];
            shuffledPool[j] = temp;
        }
        
        var songsNeeded = 10;
        var pointer = (bogotaData.seed * songsNeeded) % shuffledPool.length;
        
        var dailyTop10 = [];
        var seenArtists = new Set();
        var attempts = 0;
        
        while (dailyTop10.length < songsNeeded && attempts < shuffledPool.length) {
            var index = (pointer + attempts) % shuffledPool.length;
            var song = shuffledPool[index];
            var artistKey = song.artist ? song.artist.trim().toLowerCase() : "unknown";
            
            if (!seenArtists.has(artistKey)) {
                dailyTop10.push(song);
                seenArtists.add(artistKey);
            }
            attempts++;
        }

        renderSplitTop10(dailyTop10);
    }

    function renderSplitTop10(songs) {
        if (!songs || songs.length === 0) return;

        var featuredSong = songs[0];
        var featuredContainer = document.getElementById('top10Featured');
        var cleanTitle1 = Utils.cleanText(featuredSong.title);
        var cleanArtist1 = Utils.cleanText(featuredSong.artist);

        if (featuredContainer) {
            featuredContainer.innerHTML = 
                '<div class="top10-rank-big">1</div>' +
                '<div class="top10-featured-cover-wrap">' +
                    '<img id="featuredCoverImg" class="top10-featured-cover" src="' + CONFIG.DEFAULT_COVER + '" alt="' + cleanTitle1 + '" referrerpolicy="no-referrer">' +
                '</div>' +
                '<div class="top10-featured-info">' +
                    '<div class="top10-featured-title">' + cleanTitle1 + '</div>' +
                    '<div class="top10-featured-artist">' + cleanArtist1 + '</div>' +
                    '<div class="top10-featured-review" id="top10Review"><div id="reviewText">Cargando reseña...</div><div id="reviewMeta"></div></div>' +
                '</div>';
            
            fetchSingleCover(cleanArtist1, cleanTitle1, document.getElementById('featuredCoverImg'));
            fetchTop10Review(cleanArtist1, cleanTitle1);
        }

        var listContainer = document.getElementById('top10List');
        if (listContainer) {
            var listHtml = '';
            for (var i = 1; i < songs.length; i++) {
                var s = songs[i];
                var t = Utils.cleanText(s.title);
                var a = Utils.cleanText(s.artist);
                listHtml += 
                '<div class="top10-item">' +
                    '<div class="top10-item-rank">' + (i + 1) + '</div>' +
                    '<div class="top10-item-info">' +
                        '<div class="top10-item-title">' + t + '</div>' +
                        '<div class="top10-item-artist">' + a + '</div>' +
                    '</div>' +
                '</div>';
            }
            listContainer.innerHTML = listHtml;
        }
    }

    async function fetchTop10Review(artist, title) {
        var reviewTextDiv = document.getElementById('reviewText');
        if(!reviewTextDiv) return;

        var query = title + " " + artist; 
        var searchUrl = CONFIG.ENDPOINTS.WIKI_SEARCH + "?action=query&list=search&srsearch=" + encodeURIComponent(query) + "&format=json&origin=*";
        
        var metaInfo = "";
        var term = artist + ' ' + title;
        
        // Use optimized cache
        var cached = getFromCache(term);
        if (cached && cached.meta && cached.meta.album) {
             metaInfo = '<span class="top10-meta-block"><span style="color:var(--color-accent-green); font-weight:bold;">Álbum:</span> ' + cached.meta.album + '<br><span style="color:var(--color-accent-green); font-weight:bold;">Año:</span> ' + (cached.meta.year || "N/A") + '</span>';
        }
        
        try {
            var searchData = await Utils.safeFetchJson(searchUrl);
            if (searchData && searchData.query && searchData.query.search && searchData.query.search.length > 0) {
                var pageTitle = searchData.query.search[0].title;
                var summaryUrl = CONFIG.ENDPOINTS.WIKI_SUMMARY + encodeURIComponent(pageTitle);
                var summaryData = await Utils.safeFetchJson(summaryUrl);
                
                if (summaryData && summaryData.extract) {
                    var reviewText = Utils.truncateToSentence(summaryData.extract, 350);
                    reviewTextDiv.innerText = reviewText;
                    var metaDiv = document.getElementById('reviewMeta');
                    if (metaDiv && metaInfo) metaDiv.innerHTML = metaInfo;
                } else {
                    fetchTop10ReviewArtistFallback(artist, reviewTextDiv, metaInfo);
                }
            } else {
                fetchTop10ReviewArtistFallback(artist, reviewTextDiv, metaInfo);
            }
        } catch(e) {
            reviewTextDiv.innerText = "Disfruta del éxito número uno de hoy en Radiochar.";
            var metaDiv = document.getElementById('reviewMeta');
            if (metaDiv && metaInfo) metaDiv.innerHTML = metaInfo;
        }
    }

    async function fetchTop10ReviewArtistFallback(artist, div, metaInfo) {
        try {
            var searchUrl = CONFIG.ENDPOINTS.WIKI_SEARCH + "?action=query&list=search&srsearch=" + encodeURIComponent(artist) + "&format=json&origin=*";
            var searchData = await Utils.safeFetchJson(searchUrl);
            if (searchData && searchData.query && searchData.query.search && searchData.query.search.length > 0) {
                 var pageTitle = searchData.query.search[0].title;
                 var summaryUrl = CONFIG.ENDPOINTS.WIKI_SUMMARY + encodeURIComponent(pageTitle);
                 var summaryData = await Utils.safeFetchJson(summaryUrl);
                 if (summaryData && summaryData.extract) {
                     var coreText = "Sobre el artista: " + Utils.truncateToSentence(summaryData.extract, 300);
                     div.innerText = coreText;
                     var metaDiv = document.getElementById('reviewMeta');
                     if (metaDiv && metaInfo) metaDiv.innerHTML = metaInfo;
                 } else {
                     div.innerText = "El éxito del momento en Radiochar.";
                     var metaDiv = document.getElementById('reviewMeta');
                     if (metaDiv && metaInfo) metaDiv.innerHTML = metaInfo;
                 }
            } else {
                 div.innerText = "El éxito del momento en Radiochar.";
                 var metaDiv = document.getElementById('reviewMeta');
                 if (metaDiv && metaInfo) metaDiv.innerHTML = metaInfo;
            }
        } catch(e) { 
            div.innerText = "El éxito del momento en Radiochar.";
            var metaDiv = document.getElementById('reviewMeta');
            if (metaDiv && metaInfo) metaDiv.innerHTML = metaInfo;
        }
    }

    async function fetchSingleCover(artist, title, imgElement) {
        if (!imgElement) return;
        var term = artist + ' ' + title;
        
        // Use optimized cache
        var cached = getFromCache(term);
        if (cached) {
            imgElement.src = cached.url;
            injectMetadata(cached.meta);
            return;
        }

        var searchTerm = term.replace(/[^a-zA-Z0-9\s]/g, "");
        var data = await Utils.safeFetchJson(CONFIG.ENDPOINTS.ITUNES + "?term=" + encodeURIComponent(searchTerm) + "&media=music&limit=1");
        if (data && data.results && data.results.length > 0) {
            var track = data.results[0];
            var url = track.artworkUrl100.replace('100x100bb', '600x600bb'); 
            
            var meta = {
                album: track.collectionName,
                genre: track.primaryGenreName,
                year: track.releaseDate ? track.releaseDate.substring(0, 4) : ""
            };
            
            // Save to new cache
            saveToCache(term, { url: url, meta: meta });
            imgElement.src = url;
            injectMetadata(meta);
        }
    }

    function injectMetadata(meta) {
        var metaDiv = document.getElementById('reviewMeta');
        if (metaDiv && meta && meta.album) {
             var metaHtml = '<span class="top10-meta-block"><span style="color:var(--color-accent-green); font-weight:bold;">Álbum:</span> ' + meta.album + '<br><span style="color:var(--color-accent-green); font-weight:bold;">Año:</span> ' + (meta.year || "N/A") + '</span>';
             metaDiv.innerHTML = metaHtml;
        }
    }

    async function loadRecentTracks() {
        if (!DOM.recentTracks.track) return;
        var items = [];
        var data = await Utils.safeFetchJson(CONFIG.ENDPOINTS.RECENT_FEED + "?_=" + Date.now());
        if (data && data.items) { items = data.items; }
        if (items.length > 0) {
            renderHistory(items);
            // Ya no llamamos a processDidYouKnow aquí
        }
    }

    function renderHistory(items) {
        if (!DOM.recentTracks.track) return;
        var html = '';
        var count = 0;
        var minutesAgo = 3; 
        
        // Obtener datos actuales limpios para comparación
        var curArtist = Utils.cleanText(currentMetadata.artist || "").toLowerCase().trim();
        var curTitle = Utils.cleanText(currentMetadata.song || "").toLowerCase().trim();

        for (var i = 0; i < items.length; i++) {
            var item = items[i];
            if (count >= 10) break;
            
            var rawArtist = item.artist || "";
            var rawTitle = item.title || "";
            
            if (!rawArtist && rawTitle.includes('-')) { 
                var parts = rawTitle.split('-');
                rawArtist = parts[0].trim();
                rawTitle = parts.slice(1).join('-').trim();
            }
            
            var fullStr = (rawArtist + rawTitle).toLowerCase();
            
            // 1. Filtro de Jingles
            if (CONFIG.FILTERS.some(function(f) { return fullStr.includes(f); })) continue;
            
            // 2. Filtro de Canción Actual (La corrección solicitada)
            // Limpiamos para comparar manzanas con manzanas
            var itemArtistClean = Utils.cleanText(rawArtist).toLowerCase().trim();
            var itemTitleClean = Utils.cleanText(rawTitle).toLowerCase().trim();
            
            // Si es la misma que está sonando, la saltamos
            if (itemArtistClean === curArtist && itemTitleClean === curTitle) continue;
            
            var timeText = "Hace " + minutesAgo + " min";
            minutesAgo += Math.floor(Math.random() * (5 - 3 + 1) + 3);
            
            html += 
            '<div class="carousel-card-common hist-card" data-artist="' + rawArtist + '" data-title="' + rawTitle + '">' +
                '<div class="rank-badge blue">' + (count + 1) + '</div>' +
                '<div class="carousel-cover-wrap">' +
                    '<img class="carousel-cover lazy-cover hist-cover" src="' + (item.image || CONFIG.DEFAULT_COVER) + '" alt="Cover" onerror="this.src=\'' + CONFIG.DEFAULT_COVER + '\'" referrerpolicy="no-referrer">' +
                '</div>' +
                '<div class="carousel-info">' +
                    '<div class="carousel-title" title="' + rawTitle + '">' + rawTitle + '</div>' +
                    '<div class="carousel-artist" title="' + rawArtist + '">' + rawArtist + '</div>' +
                    '<div class="time-badge-inline"><i class="far fa-clock"></i> ' + timeText + '</div>' +
                '</div>' +
            '</div>';
            count++;
        }
        if (DOM.recentTracks.track.innerHTML !== html) { 
            DOM.recentTracks.track.innerHTML = html; 
            fetchCoversBatch(); 
        }
    }

    function fetchCoversBatch() {
        var cards = document.querySelectorAll('.hist-card');
        cards.forEach(function(card, idx) {
            setTimeout(async function() {
                var img = card.querySelector('.hist-cover');
                if (!img || img.dataset.loaded) return;
                var term = card.dataset.artist + ' ' + card.dataset.title;
                var data = await Utils.safeFetchJson(CONFIG.ENDPOINTS.ITUNES + "?term=" + encodeURIComponent(term) + "&media=music&limit=1");
                if (data && data.results && data.results.length > 0) {
                     var url = data.results[0].artworkUrl100.replace('100x100bb', '300x300bb');
                     img.src = url;
                }
                img.dataset.loaded = "true";
            }, idx * 200);
        });
    }

    // === DYK FIX (SABÍAS QUE) ===
    async function generateRandomDidYouKnow(songs) {
        if (!songs || songs.length === 0) return;
        
        var randomIndex = Math.floor(Math.random() * songs.length);
        var target = songs[randomIndex];
        
        DOM.dyk.container.style.display = 'block';
        DOM.dyk.title.innerText = target.title;
        DOM.dyk.artist.innerText = target.artist || "Artista Desconocido"; 
        DOM.dyk.text.innerText = "Cargando curiosidades...";
        
        var cleanTitle = Utils.cleanText(target.title);
        var query = target.artist + " " + cleanTitle;
        
        var results = await Promise.allSettled([
            Utils.safeFetchJson(CONFIG.ENDPOINTS.ITUNES + "?term=" + encodeURIComponent(query) + "&media=music&limit=1"),
            Utils.safeFetchJson(CONFIG.ENDPOINTS.WIKI_SEARCH + "?action=query&list=search&srsearch=" + encodeURIComponent(query) + "&format=json&origin=*")
        ]);
        
        var itunesRes = results[0];
        var wikiRes = results[1];

        if (itunesRes.status === 'fulfilled' && itunesRes.value && itunesRes.value.results && itunesRes.value.results.length > 0) {
            var t = itunesRes.value.results[0];
            DOM.dyk.cover.src = t.artworkUrl100.replace('100x100bb', '600x600bb');
            DOM.dyk.album.querySelector('span').innerText = t.collectionName || "--";
            DOM.dyk.year.querySelector('span').innerText = t.releaseDate ? t.releaseDate.substring(0,4) : "--";
        } else { 
            DOM.dyk.cover.src = CONFIG.DEFAULT_COVER; 
            DOM.dyk.album.querySelector('span').innerText = "--";
            DOM.dyk.year.querySelector('span').innerText = "--";
        }

        if (wikiRes.status === 'fulfilled' && wikiRes.value && wikiRes.value.query && wikiRes.value.query.search.length > 0) {
            var title = wikiRes.value.query.search[0].title;
            var summaryData = await Utils.safeFetchJson(CONFIG.ENDPOINTS.WIKI_SUMMARY + encodeURIComponent(title));
            if(summaryData && summaryData.extract) { 
                // V23.0 FIX: Using truncateToSentence with 450 chars limit for better text content
                DOM.dyk.text.innerText = Utils.truncateToSentence(summaryData.extract, 450); 
            } else {
                // Fallback a Artista si falla la canción específica
                processDykArtistFallback(target.artist);
            }
        } else { 
            // Fallback a Artista si no encuentra la canción
            processDykArtistFallback(target.artist);
        }
    }

    async function processDykArtistFallback(artist) {
        try {
            var searchData = await Utils.safeFetchJson(CONFIG.ENDPOINTS.WIKI_SEARCH + "?action=query&list=search&srsearch=" + encodeURIComponent(artist) + "&format=json&origin=*");
            if (searchData && searchData.query && searchData.query.search.length > 0) {
                 var pageTitle = searchData.query.search[0].title;
                 var summaryData = await Utils.safeFetchJson(CONFIG.ENDPOINTS.WIKI_SUMMARY + encodeURIComponent(pageTitle));
                 if(summaryData && summaryData.extract) {
                     DOM.dyk.text.innerText = "Sobre el artista: " + Utils.truncateToSentence(summaryData.extract, 450);
                 } else {
                     DOM.dyk.text.innerText = "Escuchas lo mejor de " + artist + " en Radiochar.";
                 }
            } else {
                 DOM.dyk.text.innerText = "Un clásico de nuestra programación habitual.";
            }
        } catch(e) { DOM.dyk.text.innerText = "Radiochar, siempre con la mejor música."; }
    }

    setInterval(loadRecentTracks, CONFIG.REFRESH_RATE_MS);
    ScheduleEngine.init();

    if (DOM.recentTracks.prev && DOM.recentTracks.next && DOM.recentTracks.track) {
        DOM.recentTracks.prev.addEventListener('click', function() { DOM.recentTracks.track.scrollBy({ left: -220, behavior: 'smooth' }); });
        DOM.recentTracks.next.addEventListener('click', function() { DOM.recentTracks.track.scrollBy({ left: 220, behavior: 'smooth' }); });
    }

})(); // END IIFE
</script>
<script src="https://cast2.my-control-panel.com/system/streaminfo.js"></script>
<script src="https://cast2.my-control-panel.com/system/recenttracks.js"></script>

  <!-- ============================================================================
  CARRUSEL PARA REPOSITORIO EN MÓVILES
  ============================================================================ -->
  <script>
  (function() {
    let currentRepoIndex = 0;
    const repoGrid = document.querySelector('.repo-grid');

    if (!repoGrid) return;

    function initRepoCarousel() {
      if (window.innerWidth > 700) return; 

      const repoCards = Array.from(repoGrid.querySelectorAll('.repo-card'));
      if (repoCards.length === 0) return;

      if (!repoGrid.parentElement.classList.contains('repo-carousel-wrapper')) {
        const wrapper = document.createElement('div');
        wrapper.className = 'repo-carousel-wrapper';

        const container = document.createElement('div');
        container.className = 'repo-carousel-container';
        container.style.display = 'grid';
        container.style.gridTemplateColumns = window.innerWidth <= 550 ? '1fr' : 'repeat(2, 1fr)';
        container.style.gap = '15px';

        const prevBtn = document.createElement('button');
        prevBtn.className = 'repo-carousel-nav prev';
        prevBtn.innerHTML = '<i class="fas fa-chevron-left"></i>';
        prevBtn.setAttribute('aria-label', 'Anterior');

        const nextBtn = document.createElement('button');
        nextBtn.className = 'repo-carousel-nav next';
        nextBtn.innerHTML = '<i class="fas fa-chevron-right"></i>';
        nextBtn.setAttribute('aria-label', 'Siguiente');

        repoCards.forEach(card => container.appendChild(card));

        wrapper.appendChild(prevBtn);
        wrapper.appendChild(container);
        wrapper.appendChild(nextBtn);

        repoGrid.parentElement.insertBefore(wrapper, repoGrid);
        repoGrid.style.display = 'none';

        prevBtn.addEventListener('click', () => navigateRepo(-1));
        nextBtn.addEventListener('click', () => navigateRepo(1));
      }
    }

    function navigateRepo(direction) {
      const container = document.querySelector('.repo-carousel-container');
      if (!container) return;

      const cards = Array.from(container.querySelectorAll('.repo-card'));
      const cardsPerView = window.innerWidth <= 550 ? 1 : 2;
      const maxIndex = Math.max(0, cards.length - cardsPerView);

      currentRepoIndex = Math.max(0, Math.min(maxIndex, currentRepoIndex + direction));

      cards.forEach((card, idx) => {
        if (idx >= currentRepoIndex && idx < currentRepoIndex + cardsPerView) {
          card.style.display = 'block';
        } else {
          card.style.display = 'none';
        }
      });

      const prevBtn = document.querySelector('.repo-carousel-nav.prev');
      const nextBtn = document.querySelector('.repo-carousel-nav.next');

      if (prevBtn) prevBtn.style.opacity = currentRepoIndex === 0 ? '0.5' : '1';
      if (nextBtn) nextBtn.style.opacity = currentRepoIndex >= maxIndex ? '0.5' : '1';
    }

    if (window.innerWidth <= 700) {
      initRepoCarousel();
      navigateRepo(0); 
    }

    let resizeTimeout;
    window.addEventListener('resize', () => {
      clearTimeout(resizeTimeout);
      resizeTimeout = setTimeout(() => {
        if (window.innerWidth <= 700) {
          initRepoCarousel();
          navigateRepo(0);
        } else {
          const wrapper = document.querySelector('.repo-carousel-wrapper');
          if (wrapper && repoGrid) {
            const cards = Array.from(wrapper.querySelectorAll('.repo-card'));
            cards.forEach(card => {
              card.style.display = 'block';
              repoGrid.appendChild(card);
            });
            wrapper.remove();
            repoGrid.style.display = 'grid';
          }
        }
      }, 250);
    });
  })();
</script>

<!-- INICIO SCRIPT DJ -->
 <script>
   /**
     * RADIOCHAR VIRTUAL DJ ENGINE v3.4 (Ultimate Edition)
     * Puntería Láser en DOM + Jerarquía Inviolable + Fix de Identidades y Horarios
     */

    const DJ_APP = {
        config: {
            FEED_URL: 'https://cast2.my-control-panel.com/recentfeed/robinson/json/',
            INTERVAL: 10000, 
            TIMEOUT: 6000,
            PLAYER_SELECTORS: {
                TITLE: '#cc_strinfo_tracktitle_robinson, .cc_strinfo_tracktitle_robinson, .track-title, .song-title',
                ARTIST: '#cc_strinfo_trackartist_robinson, .cc_strinfo_trackartist_robinson, .track-artist, .song-artist'
            },
            // FIX: Horarios, nombres e imágenes sincronizados correctamente.
            PROGRAMS: [
                { id: 'lover', name: 'Karol Morales', img: 'https://raw.githubusercontent.com/robinsonchar/radiochar/refs/heads/main/Karol%20Morales%20-%20Lover.png', json: 'https://robinsonchar.github.io/radiochar/frases-lover-city.JSON', start: 0, end: 6 },
                { id: 'wonders', name: 'Tito González', img: 'https://raw.githubusercontent.com/robinsonchar/radiochar/refs/heads/main/Tito%20Gonz%C3%A1lez%20-%20Wonders.png', json: 'https://robinsonchar.github.io/radiochar/frases-the-wonders.json', start: 6, end: 12 },
                { id: 'piedras', name: 'Salma Cifuentes', img: 'https://raw.githubusercontent.com/robinsonchar/radiochar/refs/heads/main/Salma%20Cifuentes%20-%20Piedras.png', json: 'https://robinsonchar.github.io/radiochar/frases-pateando-piedras.JSON', start: 12, end: 15 },
                { id: 'rockstars', name: 'Jhon Martin', img: 'https://raw.githubusercontent.com/robinsonchar/radiochar/refs/heads/main/Jhon%20Martin%20-%20Rockstars.png', json: 'https://robinsonchar.github.io/radiochar/frases-rockstars.JSON', start: 15, end: 20 },
                { id: 'hits', name: 'Miranda Fuentes', img: 'https://raw.githubusercontent.com/robinsonchar/pruebasradiochar/refs/heads/main/Miranda%20Fuentes%20-%20Hits.png', json: 'https://robinsonchar.github.io/radiochar/frases-hits-dont-lie.JSON', start: 20, end: 24 }
            ],
            FALLBACKS: [
                "¡Disfruta de la mejor música en Radiochar!",
                "Conectados con tu ritmo las 24 horas.",
                "Siente la energía de nuestra programación virtual.",
                "Transmitiendo éxitos sin fronteras."
            ]
        },
        state: { cache: {}, lastTrackId: null, isFirstRun: true, isLoaded: false }
    };

    /**
     * NORMALIZACIÓN ESTRICTA
     */
    function normalize(str) {
        if (!str) return '';
        return str.toString()
            .normalize("NFD").replace(/[\u0300-\u036f]/g, "") 
            .toLowerCase()
            .replace(/[^a-z0-9]/g, ''); 
    }

    function getActiveDJ() {
        const hour = new Date().getHours();
        return DJ_APP.config.PROGRAMS.find(p => hour >= p.start && hour < p.end) || DJ_APP.config.PROGRAMS[0];
    }

    /**
     * EXTRACTOR INDESTRUCTIBLE v3
     */
    function salvageJSON(text) {
        let cleanText = text
            .replace(/[\u201C\u201D\u201F\u2033\u2036]/g, '"') 
            .replace(/[\u2018\u2019\u201A\u201B]/g, "'")
            .replace(/[\u0000-\u001F\u007F-\u009F]/g, "") 
            .replace(/^\uFEFF/, "");

        let results = [];
        try { 
            const parsed = JSON.parse(cleanText);
            const data = parsed.frases_por_cancion || (parsed.programa && parsed.programa.frases_por_cancion) || parsed;
            if (Array.isArray(data)) return data;
        } catch (e) {
            console.warn("⚠️ [JSON ENGINE] Error de sintaxis detectado. Activando Extractor Manual Regex...");
        }

        const blocks = cleanText.match(/\{[^}]*?"frase"[^}]*\}/gi);
        if (blocks) {
            blocks.forEach(b => {
                try {
                    let fixed = b.replace(/,\s*\}/g, '}'); 
                    let pFrag = JSON.parse(fixed);
                    if (pFrag.frase) results.push(pFrag);
                } catch(err) {
                    const artM = b.match(/"artista"\s*:\s*"((?:\\"|[^"])*)"/i);
                    const titM = b.match(/"(?:cancion|titulo)"\s*:\s*"((?:\\"|[^"])*)"/i);
                    const phrM = b.match(/"frase"\s*:\s*"((?:\\"|[^"])*)"/i);
                    
                    if (phrM) {
                        results.push({
                            artista: artM ? artM[1].replace(/\\"/g, '"') : "",
                            cancion: titM ? titM[1].replace(/\\"/g, '"') : "",
                            frase: phrM[1].replace(/\\"/g, '"')
                        });
                    }
                }
            });
        }
        return results.length > 0 ? results : null;
    }

    async function preloadLibrary() {
        console.log("🛠️ [VIRTUAL DJ] Reconstruyendo Caché de Conocimiento...");
        const tasks = DJ_APP.config.PROGRAMS.map(async (prog) => {
            try {
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), DJ_APP.config.TIMEOUT);
                const response = await fetch(`${prog.json}?v=${Date.now()}`, { signal: controller.signal });
                clearTimeout(timeoutId);

                if (!response.ok) throw new Error("HTTP Status " + response.status);
                const text = await response.text();
                const data = salvageJSON(text);
                
                DJ_APP.state.cache[prog.id] = data || []; 
            } catch (err) {
                console.error(`[ERROR] Conexión fallida con el archivo: ${prog.id}`);
                DJ_APP.state.cache[prog.id] = []; 
            }
        });
        
        await Promise.allSettled(tasks);
        DJ_APP.state.isLoaded = true;
        console.log("✅ [VIRTUAL DJ] Motores de texto listos.");
    }

    /**
     * ALGORITMO DETERMINISTA (Cero Caos)
     */
    function getPhrase(progId, currentArtist, currentTitle) {
        const library = DJ_APP.state.cache[progId];
        
        if (!library || !Array.isArray(library) || library.length === 0) {
            return DJ_APP.config.FALLBACKS[Math.floor(Math.random() * DJ_APP.config.FALLBACKS.length)];
        }

        const nTitle = normalize(currentTitle);
        const nArtist = normalize(currentArtist);

        console.log(`[🔍 MATCH] Buscando: Canción="${nTitle}" | Artista="${nArtist}"`);

        const songMatches = library.filter(item => {
            const jsonTitle = normalize(item.titulo || item.cancion || "");
            if (!jsonTitle || jsonTitle.length < 3) return false;
            return jsonTitle === nTitle || nTitle.includes(jsonTitle) || jsonTitle.includes(nTitle);
        });

        if (songMatches.length > 0) {
            const perfectMatch = songMatches.find(item => {
                const jsonArtist = normalize(item.artista || "");
                return jsonArtist === nArtist || nArtist.includes(jsonArtist) || jsonArtist.includes(nArtist);
            });

            if (perfectMatch && perfectMatch.frase) {
                console.log(`[✅ MATCH 100%] Canción y Artista confirmados.`);
                return perfectMatch.frase;
            }

            if (songMatches[0].frase) {
                console.log(`[⚠️ MATCH PARCIAL] Canción confirmada.`);
                return songMatches[0].frase;
            }
        }

        console.log(`[🛑 SIN MATCH] Retornando frase genérica segura.`);
        
        const genericLibraryPhrases = library.filter(item => {
            const jsonTitle = normalize(item.titulo || item.cancion || "");
            return jsonTitle === "" || jsonTitle === "generico";
        });

        if (genericLibraryPhrases.length > 0) {
            return genericLibraryPhrases[Math.floor(Math.random() * genericLibraryPhrases.length)].frase;
        }

        return DJ_APP.config.FALLBACKS[Math.floor(Math.random() * DJ_APP.config.FALLBACKS.length)];
    }

    function getTrackFromDOM() {
        try {
            const titleEls = document.querySelectorAll(DJ_APP.config.PLAYER_SELECTORS.TITLE);
            const artistEls = document.querySelectorAll(DJ_APP.config.PLAYER_SELECTORS.ARTIST);
            
            let title = "";
            let artist = "";

            const invalidWords = [
                'ESTAMOS PRESENTANDO', 'CARGANDO', 'RADIOCHAR', 'AL AIRE', 
                'PIDE TU CANCIÓN', 'ROCKSTARS', 'HITS DON', 'ARTISTA', 
                'SINTONIZANDO', 'TITULO', 'CANCION', 'CONECTANDO'
            ];
            
            const isCleanText = (txt) => {
                if (!txt) return false;
                const upper = txt.toUpperCase().trim();
                if (upper.length < 2) return false;
                
                for (let word of invalidWords) {
                    if (upper.includes(word) || upper === word) return false;
                }
                return true;
            };

            for (let el of titleEls) {
                let text = (el.innerText || el.textContent).trim();
                if (isCleanText(text)) { title = text; break; }
            }

            for (let el of artistEls) {
                let text = (el.innerText || el.textContent).trim();
                if (isCleanText(text) && text !== title) { artist = text; break; }
            }

            if (title) {
                if (!artist && title.includes(' - ')) {
                    const parts = title.split(' - ');
                    artist = parts[0].trim();
                    title = parts.slice(1).join(' - ').trim();
                }
                return { artist: artist || "Radiochar", title, source: 'DOM' };
            }
        } catch (e) {}
        return null; 
    }

    async function getTrackFromFeed() {
        try {
            const controller = new AbortController();
            const id = setTimeout(() => controller.abort(), 5000);
            const response = await fetch(`${DJ_APP.config.FEED_URL}?t=${Date.now()}`, { signal: controller.signal });
            clearTimeout(id);
            if (!response.ok) return null;
            const data = await response.json();
            
            if (data && data.length > 0 && data[0].title) {
                let trackArtist = data[0].artist;
                let trackTitle = data[0].title;
                
                if (!trackArtist && trackTitle.includes(' - ')) {
                    const parts = trackTitle.split(' - ');
                    trackArtist = parts[0].trim();
                    trackTitle = parts.slice(1).join(' - ').trim();
                }
                
                return { artist: trackArtist || "Radiochar", title: trackTitle, source: 'FEED' };
            }
        } catch (e) {}
        return null;
    }

    function updateUI(dj, trackInfo, phrase) {
        const container = document.getElementById('dj-content');
        const skeleton = document.getElementById('dj-skeleton');

        if (skeleton) skeleton.classList.add('hidden');
        if (container) container.classList.remove('hidden');

        container.style.opacity = '0';
        container.style.transform = 'translateY(5px)';

        setTimeout(() => {
            document.getElementById('dj-avatar').src = dj.img;
            document.getElementById('dj-name').textContent = dj.name;
            document.getElementById('current-track').textContent = trackInfo;
            const phraseClean = phrase.replace(/^["']+|["']+$/g, '').trim();
            document.getElementById('dj-phrase').textContent = phraseClean;
            container.style.opacity = '1';
            container.style.transform = 'translateY(0)';
        }, 200);
    }

    async function syncStation() {
        const trackData = getTrackFromDOM() || await getTrackFromFeed();
        
        if (!trackData) {
            console.warn("[⚠️ VIRTUAL DJ] Sin señal del reproductor. Mostrando fallback.");
            if (DJ_APP.state.isFirstRun) {
                const dj = getActiveDJ();
                updateUI(dj, "Radiochar - Música en vivo", DJ_APP.config.FALLBACKS[0]);
                DJ_APP.state.isFirstRun = false;
            }
            return;
        }

        const { artist, title, source } = trackData;
        const currentTrackId = normalize(`${artist}${title}`);

        if (currentTrackId === DJ_APP.state.lastTrackId && !DJ_APP.state.isFirstRun) return;

        console.log(`[📡 LECTURA ${source}] Sonando: ${artist} - ${title}`);

        const activeDJ = getActiveDJ();
        const phrase = getPhrase(activeDJ.id, artist, title);
        
        updateUI(activeDJ, `${artist} - ${title}`, phrase);
        DJ_APP.state.lastTrackId = currentTrackId;
        DJ_APP.state.isFirstRun = false;
    }

    window.addEventListener('load', async () => {
        const safetyTimeout = setTimeout(() => {
            if (DJ_APP.state.isFirstRun) {
                console.warn("[VIRTUAL DJ] Timeout. Forzando UI de emergencia...");
                const dj = getActiveDJ();
                updateUI(dj, "Radiochar - Conectado", DJ_APP.config.FALLBACKS[0]);
                DJ_APP.state.isFirstRun = false;
            }
        }, 7000);

        try {
            await preloadLibrary();
            await syncStation();
            clearTimeout(safetyTimeout);
            
            const observer = new MutationObserver(() => syncStation());
            observer.observe(document.body, { childList: true, subtree: true, characterData: true });
            
            setInterval(syncStation, DJ_APP.config.INTERVAL);
        } catch (e) {
            console.error("[CRÍTICO] Fallo general de motor:", e);
            clearTimeout(safetyTimeout);
            const dj = getActiveDJ();
            updateUI(dj, "Radiochar - Sistema Activo", DJ_APP.config.FALLBACKS[0]);
            DJ_APP.state.isFirstRun = false;
        }
    });
 </script>
<!-- FIN SCRIPT DJ -->

<!-- INICIO SCRIPT COMPARTIR HIBRIDO -->
<script>
    window.shareCurrentTrack = async function() {
        // Leer el DOM actual sin interferir con el motor del DJ
        const trackText = document.getElementById('current-track').textContent || '';
        const djName = document.getElementById('dj-name').textContent || 'Radiochar';
        let phrase = document.getElementById('dj-phrase').textContent || '';
        
        // Limpiamos los espacios en blanco o comillas dobles generadas por CSS
        phrase = phrase.trim();

        const albumArtEl = document.getElementById('albumArt');
        let coverImgUrl = albumArtEl ? albumArtEl.src : null;

        // Construir el texto premium
        const shareText = `${phrase}\n\n📻 ${djName} presentando "${trackText}" en RADIOCHAR. Escúchalo en vivo aquí:`;
        const shareUrl = "https://radiochar.online"; 

        // Verificamos si es móvil y soporta la Web Share API
        if (navigator.share) {
            try {
                let fileToShare = null;
                // Intentar descargar la portada si el navegador lo permite y no es la foto por defecto
                if (coverImgUrl && !coverImgUrl.includes('radiochar-vice.png') && navigator.canShare) {
                    try {
                        const response = await fetch(coverImgUrl);
                        const blob = await response.blob();
                        fileToShare = new File([blob], 'radiochar-cover.jpg', { type: blob.type });
                    } catch(e) {
                        console.warn("No se pudo adjuntar la imagen", e);
                    }
                }

                const shareData = {
                    title: 'Radiochar en Vivo',
                    text: shareText,
                    url: shareUrl
                };

                // Agregamos el archivo solo si existe y el navegador permite compartir archivos
                if (fileToShare && navigator.canShare({ files: [fileToShare] })) {
                    shareData.files = [fileToShare];
                }

                await navigator.share(shareData);
            } catch (err) {
                // Si el usuario simplemente canceló no hacemos nada, de lo contrario mostramos el Modal de PC
                if (err.name !== 'AbortError') {
                    openShareModal(shareText, shareUrl);
                }
            }
        } else {
            // Si el navegador no soporta Web Share API (Navegadores de PC), abrir Modal de botones
            openShareModal(shareText, shareUrl);
        }
    };

    window.currentShareText = "";
    window.currentShareUrl = "";

    window.openShareModal = function(text, url) {
        window.currentShareText = text;
        window.currentShareUrl = url;
        const overlay = document.getElementById('shareFallbackModal');
        if(overlay) overlay.classList.add('active');
    };

    window.closeShareModal = function() {
        const overlay = document.getElementById('shareFallbackModal');
        if(overlay) overlay.classList.remove('active');
    };

    window.shareToPlatform = function(platform) {
        const text = encodeURIComponent(window.currentShareText);
        const url = encodeURIComponent(window.currentShareUrl);
        let shareLink = "";

        if (platform === 'wa') {
            shareLink = `https://api.whatsapp.com/send?text=${text}%20${url}`;
        } else if (platform === 'fb') {
            shareLink = `https://www.facebook.com/sharer/sharer.php?u=${url}&quote=${text}`;
        } else if (platform === 'x') {
            shareLink = `https://twitter.com/intent/tweet?text=${text}&url=${url}`;
        }

        if (shareLink) {
            window.open(shareLink, '_blank', 'width=600,height=600');
            closeShareModal();
        }
    };

    // Cerrar modal al hacer clic en el fondo oscuro
    document.addEventListener('DOMContentLoaded', () => {
        const overlay = document.getElementById('shareFallbackModal');
        if (overlay) {
            overlay.addEventListener('click', (e) => {
                if (e.target === overlay) closeShareModal();
            });
        }
    });
</script>
<!-- FIN SCRIPT COMPARTIR -->
</body>
</html>


